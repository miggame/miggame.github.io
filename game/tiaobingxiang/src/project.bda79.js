__require=function e(t,i,c){function o(r,s){if(!i[r]){if(!t[r]){var l=r.split("/");if(l=l[l.length-1],!t[l]){var a="function"==typeof __require&&__require;if(!s&&a)return a(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+r+"'")}}var u=i[r]={exports:{}};t[r][0].call(u.exports,function(e){return o(t[r][1][e]||e)},u,u.exports,e,t,i,c)}return i[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<c.length;r++)o(c[r]);return o}({IceModule:[function(e,t,i){"use strict";cc._RF.push(t,"a85321ID6xBlp20IhIuox1x","IceModule"),t.exports={Msg:{ScoreCollideMsg:"IceModule.ScoreCollideMsg",LeftCollideMsg:"IceModule.LeftCollideMsg",RightCollideMsg:"IceModule.RightCollideMsg",Collide:"IceModule.Collide",ClearCollide:"IceModule.ClearCollide",EndReadyGo:"EndReadyGo"},Score:0,IcePosArr:[],Combo:0,Level:0,TotalScore:0,Time:60,Dir:1},cc._RF.pop()},{}],Ice:[function(e,t,i){"use strict";cc._RF.push(t,"80634xqSlhJxq05V+O8ElMd","Ice");var c=e("Observer"),o=e("ObserverMgr"),n=e("IceModule");cc.Class({extends:c,properties:{spIce:{displayName:"spIce",default:null,type:cc.Sprite}},_getMsgList:function(){return[n.Msg.ClearCollide]},_onMsg:function(e,t){e===n.Msg.ClearCollide&&this._clearCollide()},onEnable:function(){cc.director.getCollisionManager().enabled=!0,cc.director.getCollisionManager().enabledDebugDraw=!1},onDisable:function(){cc.director.getCollisionManager().enabled=!1,cc.director.getCollisionManager().enabledDebugDraw=!1},onCollisionEnter:function(e,t){var i=e.world.aabb,c=e.world.preAabb.clone(),r=t.world.aabb,s=t.world.preAabb.clone();if(s.x=r.x,c.x=i.x,s.y=r.y,c.y=i.y,cc.Intersection.rectRect(s,c))if(c.yMin<=s.yMax&&c.yMin>s.yMin&&c.yMax>s.yMax&&c.xMax>s.xMin&&c.xMin<s.xMax){if(-1===n.Dir){this.node.stopAllActions();var l={x:this.node.x,y:this.node.y,h:this.node.height};o.dispatchMsg(n.Msg.ScoreCollideMsg,l)}}else c.xMin<s.xMax&&c.xMax>s.xMax?(this.node.stopAllActions(),o.dispatchMsg(n.Msg.LeftCollideMsg,"left")):c.xMax>s.xMin&&c.xMax<s.xMax&&(this.node.stopAllActions(),o.dispatchMsg(n.Msg.LeftCollideMsg,"right"))},onLoad:function(){this._initMsg()},start:function(){},initMove:function(e,t){var i=cc.view.getVisibleSize().width,c=cc.moveTo(1.5,cc.p(i,this.node.y)),o=cc.moveTo(1.5,cc.p(-i,this.node.y));"left"===e?this.node.runAction(c):"right"===e&&this.node.runAction(o);var n="uiModule/ice"+t;cc.loader.loadRes(n,cc.SpriteFrame,function(e,t){this.spIce.spriteFrame=t}.bind(this))},_clearCollide:function(){this.node.stopAllActions(),cc.director.getCollisionManager().enabled=!1,cc.director.getCollisionManager().enabledDebugDraw=!1}}),cc._RF.pop()},{IceModule:"IceModule",Observer:"Observer",ObserverMgr:"ObserverMgr"}],LoginScene:[function(e,t,i){"use strict";cc._RF.push(t,"04767NjzYJBKLZCtA1kHq4T","LoginScene");var c=e("Observer");cc.Class({extends:c,properties:{},_getMsgList:function(){return[]},_onMsg:function(e,t){},onLoad:function(){this._initMsg()},start:function(){},onBtnClickToStart:function(){cc.director.loadScene("MainScene")}}),cc._RF.pop()},{Observer:"Observer"}],MainScene:[function(e,t,i){"use strict";cc._RF.push(t,"4cbe7lAVy5KYrFIHbL/2pPf","MainScene");var c=e("Observer"),o=e("ObserverMgr"),n=e("IceModule");cc.Class({extends:c,properties:{icePre:{displayName:"icePre",default:null,type:cc.Prefab},spPlayer:{displayName:"spPlayer",default:null,type:cc.Sprite},touchLayer:{displayName:"touchLayer",default:null,type:cc.Node},iceLayer:{displayName:"iceLayer",default:null,type:cc.Node},newIceLayer:{displayName:"newIceLayer",default:null,type:cc.Node},lblScore:{displayName:"lblScore",default:null,type:cc.Label},followNode:{displayName:"followNode",default:null,type:cc.Node},lblTime:{displayName:"lblTime",default:null,type:cc.Label},lblScoreAct:{displayName:"lblScoreAct",default:null,type:cc.Label},tutorLayer:{displayName:"tutorLayer",default:null,type:cc.Node},jumpLayer:{displayName:"jumpLayer",default:null,type:cc.Node},spYun:{displayName:"spYun",default:null,type:cc.Sprite},spXingGuang:{displayName:"spXingGuang",default:null,type:cc.Sprite},spMoon:{displayName:"spMoon",default:null,type:cc.Sprite},spFloor:{displayName:"spFloor",default:null,type:cc.Sprite},camera:{displayName:"camera",default:null,type:cc.Node},spTimeBar:{displayName:"spTimeBar",default:null,type:cc.Sprite},readyLayer:{displayName:"readyLayer",default:null,type:cc.Node},_startFlag:!1},_getMsgList:function(){return[n.Msg.RightCollideMsg,n.Msg.LeftCollideMsg,n.Msg.ScoreCollideMsg,n.Msg.Collide,n.Msg.EndReadyGo]},_onMsg:function(e,t){if(e===n.Msg.ScoreCollideMsg){if(this.spPlayer.node.stopAllActions(),this.spPlayer.node.y=t.y+t.h/2+this.spPlayer.node.height/2,this.spPlayer.node.getChildByName("effect_jump").active=!0,this.spPlayer.node.getChildByName("effect_jump").getComponent(cc.Animation).play("effect_jump"),this.spPlayer.node.getChildByName("animal"+this._playerId).getComponent(cc.Animation).play("animal"+this._playerId+"_root"),this._iceHeight=t.h,0===n.IcePosArr.length)n.Score++,n.IcePosArr.push(t),this._playScoreAct();else{var i=parseInt(_.last(n.IcePosArr).x),c=parseInt(t.x);c<i+30&&c>i-30?(n.Combo++,this._playComboAct()):(n.Combo=0,n.Score++,this._playScoreAct()),n.IcePosArr.push(t)}n.Level++,n.Level>=5&&(this.followNode.y+=this.iceLayer.children[0].height,this._scrollBg()),this._refresh()}else e===n.Msg.LeftCollideMsg?(this.spPlayer.node.stopAllActions(),this._rollover(t)):e===n.Msg.RightCollideMsg?(this.spPlayer.node.stopAllActions(),this._rollover(t)):e===n.Msg.EndReadyGo&&this._hideTutor()},_onError:function(e,t,i){},onEnable:function(){cc.director.getCollisionManager().attachDebugDrawToCamera(this.camera.getComponent(cc.Camera))},onDisable:function(){cc.director.getPhysicsManager().detachDebugDrawFromCamera(this.camera.getComponent(cc.Camera))},onLoad:function(){this._initBg(),this._initMsg(),this._refresh(),this.spPlayer.node.getChildByName("effect_combo").active=!1,this.spPlayer.node.getChildByName("effect_jump").active=!1,this.lblScoreAct.node.x=cc.view.getVisibleSize().width/2*.8,this.lblScoreAct.node.y=cc.view.getVisibleSize().height/2*.8,this.lblScoreAct.node.active=!1,this.spPlayer.node.getChildByName("spCombo").active=!1,this.readyLayer.active=!1,this._getPlayer()},start:function(){},onBtnClickToJump:function(){this.spPlayer.node.getChildByName("animal"+this._playerId).getComponent(cc.Animation).play("animal"+this._playerId+"_jump");var e=2*this.spPlayer.node.height,t=cc.moveBy(.2,cc.p(0,e)).easing(cc.easeCubicActionOut()),i=cc.moveBy(.2,cc.p(0,-e)).easing(cc.easeCubicActionIn()),c=cc.callFunc(function(){n.Dir=1},this),o=cc.callFunc(function(){n.Dir=-1},this),r=cc.sequence(c,t,o,i);this.spPlayer.node.runAction(r),this.jumpLayer.getComponent(cc.Button).interactable=!1},_initIceDir:function(){var e=cc.view.getVisibleSize().width,t=_.sample(this._iceDirArr),i=cc.instantiate(this.icePre);i.parent=this.newIceLayer,i.y=this.spPlayer.node.y,"left"===t?i.x=-i.width/2-e/2:"right"===t&&(i.x=i.width/2+e/2),i.getComponent("Ice").initMove(t,this._iceColor)},_initView:function(){this._iceDirArr=["left","right"];this._iceColor=_.sample([1,2,3,4,5,6]);var e=parseInt(n.Score)+parseInt(2*n.Combo);n.TotalScore=e,n.Score=e,this.lblScore.string=e,this.lblTime.string=n.Time},_refresh:function(){this.jumpLayer.getComponent(cc.Button).interactable=!0,this._initView(),this._startFlag&&this._initIceDir()},_scrollBg:function(){var e=cc.view.getVisibleSize().width,t=cc.view.getVisibleSize().height;cc.follow(this.followNode,cc.Rect(0,0,e,10*t));this._playBgAct(),this.camera.runAction(cc.moveBy(.15,cc.p(0,this._iceHeight)))},_gameOver:function(){cc.director.loadScene("OverScene")},_countDown:function(){n.Time--;var e=this.spTimeBar.fillStart;(e=1-parseFloat(n.Time/60))>=1&&(e=1),this.spTimeBar.fillStart=e,this.lblTime.string=n.Time,n.Time<=0&&this._gameOver()},onBtnClickToTutor:function(){this.tutorLayer.active=!1,this.readyLayer.active=!0,this.jumpLayer.getComponent(cc.Button).interactable=!1},_hideTutor:function(){this._startFlag=!0,this.schedule(this._countDown,1),this._initIceDir(),this.jumpLayer.getComponent(cc.Button).interactable=!0},_rollover:function(e){this.jumpLayer.getComponent(cc.Button).interactable=!1,this._startFlag=!1,o.dispatchMsg(n.Msg.ClearCollide,null);var t=null,i=null;"left"===e?(t=cc.moveBy(.5,cc.p(cc.view.getVisibleSize().width,0)),i=cc.rotateBy(.5,3600)):"right"===e&&(t=cc.moveBy(.5,cc.p(-cc.view.getVisibleSize().width,0)),i=cc.rotateBy(.5,-3600));var c=cc.spawn(i,t),r=cc.callFunc(this._gameOver,this);this.spPlayer.node.runAction(cc.sequence(c,r))},_playScoreAct:function(){this.lblScoreAct.node.active=!0,this.lblScoreAct.node.opacity=255,this.lblScoreAct.string="+1";var e=cc.fadeOut(.5),t=cc.moveBy(.5,cc.p(0,3*this.lblScoreAct.node.height)),i=cc.spawn(t,e);this.lblScoreAct.node.x=cc.view.getVisibleSize().width/2*.8,this.lblScoreAct.node.y=cc.view.getVisibleSize().height/2*.8;var c=cc.place(cc.p(cc.view.getVisibleSize().width/2*.8,cc.view.getVisibleSize().height/2*.8));this.lblScoreAct.node.runAction(cc.sequence(i,c))},_playComboAct:function(){var e=this.spPlayer.node.getChildByName("spCombo");e.active=!0,e.opacity=255,e.getChildByName("comboLabel").getComponent(cc.Label).string=n.Combo;var t=cc.fadeOut(.5);e.runAction(t),this.spPlayer.node.getChildByName("effect_combo").active=!0,this.spPlayer.node.getChildByName("effect_combo").getComponent(cc.Animation).play("effect_combo")},_initBg:function(){this.spYun.node.y=2*cc.view.getVisibleSize().height,this.spMoon.node.y=2*cc.view.getVisibleSize().height,this.spXingGuang.node.y=2*cc.view.getVisibleSize().height},_playBgAct:function(){var e=cc.callFunc(function(){this.spYun.node.y<2*-cc.view.getVisibleSize().height&&(this.spYun.node.y=2*cc.view.getVisibleSize().height)},this);this.spYun.node.runAction(cc.sequence(cc.moveBy(.15,cc.p(0,-this._iceHeight/4*3)),e)),this.spMoon.node.runAction(cc.moveBy(.15,cc.p(0,-this._iceHeight/4*2))),this.spXingGuang.node.runAction(cc.moveBy(.15,cc.p(0,-this._iceHeight/4))),this.spFloor.node.runAction(cc.moveBy(.15,cc.p(0,-this._iceHeight/4)))},_getPlayer:function(){this.spPlayer.node.getChildByName("animal1").active=!1,this.spPlayer.node.getChildByName("animal2").active=!1;var e=_.sample([1,2]);this._playerId=e,1===e?this.spPlayer.node.getChildByName("animal"+e).active=!0:2===e&&(this.spPlayer.node.getChildByName("animal"+e).active=!0)}}),cc._RF.pop()},{IceModule:"IceModule",Observer:"Observer",ObserverMgr:"ObserverMgr"}],ObserverMgr:[function(e,t,i){"use strict";cc._RF.push(t,"96a9fKB80JP4otpluoqTtFN","ObserverMgr"),t.exports={obsArray:{},addEventListener:function(e,t,i){void 0===i&&console.log("[ObserverMgr] \u6ce8\u518c\u6d88\u606f [%s]:%s \u7684\u4f5c\u7528\u4e8e\u672a\u5b9a\u4e49",e,t.name),void 0===this.obsArray[e]&&(this.obsArray[e]=[]);for(var c=0;c<this.obsArray[e].length;c++){var o=this.obsArray[e][c];if(o.func===t&&o.ob===i)return}this.obsArray[e].push({func:t,ob:i})},removeEventListener:function(e,t,i){var c=!1,o=this.obsArray[e];if(o)for(var n=0;n<o.length;){var r=o[n],s=r.func,l=r.ob;t===s&&i===l?(o.splice(n,1),c=!0):n++}return c},removeEventListenerWithObject:function(e){for(var t in this.obsArray)for(var i=this.obsArray[t],c=0;c<i.length;){i[c].ob===e?i.splice(c,1):c++}},cleanAllEventListener:function(){this.obsArray={}},dispatchMsg:function(e,t){var i=this.obsArray[e];if(void 0!==i)for(var c=0;c<i.length;c++){var o=i[c],n=o.func,r=o.ob;n&&r&&n.apply(r,[e,t])}else console.log("\u6d88\u606f\u5217\u8868\u4e2d\u4e0d\u5b58\u5728: "+e)}},cc._RF.pop()},{}],Observer:[function(e,t,i){"use strict";cc._RF.push(t,"84415U98MhB2I7mu0WriWox","Observer");var c=e("ObserverMgr");cc.Class({extends:cc.Component,_initMsg:function(){for(var e=this._getMsgList(),t=0;t<e.length;t++){var i=e[t];c.addEventListener(i,this._onMsg,this)}},onLoad:function(){},_getMsgList:function(){return[]},_onMsg:function(e,t){},_onError:function(e,t,i){},_onNetOpen:function(){},_onErrorDeal:function(e,t){var i=t[0],c=t[1],o=t[2];this._onError(i,c,o)},onDisable:function(){c.removeEventListenerWithObject(this)},onEnable:function(){},onDestroy:function(){c.removeEventListenerWithObject(this)}}),cc._RF.pop()},{ObserverMgr:"ObserverMgr"}],OverScene:[function(e,t,i){"use strict";cc._RF.push(t,"252c73DKlpDU57SPuUbA+RF","OverScene");var c=e("Observer"),o=e("IceModule");cc.Class({extends:c,properties:{lblScore:{displayName:"lblScore",default:null,type:cc.Label},lblResult:{displayName:"lblResult",default:null,type:cc.Label}},_getMsgList:function(){return[]},_onMsg:function(e,t){},onLoad:function(){this._initMsg(),this.lblScore.string=o.TotalScore,0===o.TotalScore?this.lblResult.string="\u8d85\u8fc70%\u8001\u94c1":o.TotalScore<10?this.lblResult.string="\u8d85\u8fc75%\u8001\u94c1":o.TotalScore<30?this.lblResult.string="\u8d85\u8fc715%\u8001\u94c1":o.TotalScore<50?this.lblResult.string="\u8d85\u8fc726%\u8001\u94c1":o.TotalScore<70?this.lblResult.string="\u8d85\u8fc733%\u8001\u94c1":o.TotalScore<90?this.lblResult.string="\u8d85\u8fc747%\u8001\u94c1":o.TotalScore<110?this.lblResult.string="\u8d85\u8fc759%\u8001\u94c1":o.TotalScore<130?this.lblResult.string="\u8d85\u8fc768%\u8001\u94c1":o.TotalScore<130?this.lblResult.string="\u8d85\u8fc777%\u8001\u94c1":o.TotalScore<150?this.lblResult.string="\u8d85\u8fc788%\u8001\u94c1":o.TotalScore<170?this.lblResult.string="\u8d85\u8fc797%\u8001\u94c1":o.TotalScore<190&&(this.lblResult.string="\u8d85\u8fc799%\u8001\u94c1")},start:function(){},onBtnClickToRestart:function(){this._reset(),cc.director.loadScene("MainScene")},onBtnClickToBack:function(){this._reset(),cc.director.loadScene("LoginScene")},onBtnClickToStart:function(){this._reset(),cc.director.loadScene("LoginScene")},_reset:function(){o.Score=0,o.Combo=0,o.TotalScore=0,o.Level=0,o.IcePosArr=[],o.Time=60}}),cc._RF.pop()},{IceModule:"IceModule",Observer:"Observer"}],ReadyGo:[function(e,t,i){"use strict";cc._RF.push(t,"8ed5b5Y3uRDgLW1UfAGGLYF","ReadyGo");var c=e("Observer"),o=e("ObserverMgr"),n=e("IceModule");cc.Class({extends:c,properties:{},_getMsgList:function(){return[]},_onMsg:function(e,t){},onLoad:function(){this._initMsg()},start:function(){},onEndOfReadyGo:function(){o.dispatchMsg(n.Msg.EndReadyGo,null)}}),cc._RF.pop()},{IceModule:"IceModule",Observer:"Observer",ObserverMgr:"ObserverMgr"}]},{},["Observer","ObserverMgr","LoginScene","MainScene","ReadyGo","Ice","IceModule","OverScene"]);