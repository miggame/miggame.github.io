__require=function e(t,i,a){function n(o,l){if(!i[o]){if(!t[o]){var c=o.split("/");if(c=c[c.length-1],!t[c]){var r="function"==typeof __require&&__require;if(!l&&r)return r(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+o+"'")}}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){return n(t[o][1][e]||e)},d,d.exports,e,t,i,a)}return i[o].exports}for(var s="function"==typeof __require&&__require,o=0;o<a.length;o++)n(a[o]);return n}({AudioMgr:[function(e,t,i){"use strict";cc._RF.push(t,"1c5e5Nl/BRJTb0A4uTojjJF","AudioMgr"),t.exports={_bgMusic:null,_guideMusic:null,playButtonSound:function(){cc.loader.loadRes("sound/btn",cc.AudioClip,function(e,t){cc.audioEngine.play(t)})},playHitSound:function(){cc.loader.loadRes("sound/hit",cc.AudioClip,function(e,t){cc.audioEngine.play(t)})},playWinSound:function(){cc.loader.loadRes("sound/win",cc.AudioClip,function(e,t){cc.audioEngine.play(t)})},playFailSound:function(){cc.loader.loadRes("sound/fail",cc.AudioClip,function(e,t){cc.audioEngine.play(t)})},playMainMusic:function(){cc.loader.loadRes("sound/bg",cc.AudioClip,function(e,t){this._bgMusic=cc.audioEngine.play(t,!0)}.bind(this))},stopCurrentBackgroundMusic:function(){null!==this._bgMusic&&(cc.audioEngine.stop(this._bgMusic),this._bgMusic=null)},playEffectMusic:function(e,t){void 0===t&&(t=!1),cc.loader.loadRes(e,cc.AudioClip,function(e,i){cc.audioEngine.playEffect(i,t)})}},cc._RF.pop()},{}],BallItem:[function(e,t,i){"use strict";cc._RF.push(t,"247feXhDf1H77s0exrnK+q/","BallItem");var a=e("UIMgr");cc.Class({extends:cc.Component,properties:{spBall:{displayName:"spBall",default:null,type:cc.Sprite},lblName:{displayName:"lblName",default:null,type:cc.Label},lblPrice:{displayName:"lblPrice",default:null,type:cc.Label},btnBuy:{displayName:"btnBuy",default:null,type:cc.Sprite},btnUsed:{displayName:"btnUsed",default:null,type:cc.Sprite},spUsedBg:{displayName:"spUsedBg",default:null,type:cc.Sprite}},start:function(){},initView:function(e){var t="";t="default"!==e.type?"shop/ball/ball_img_"+e.type+e.size+"_0_1":"shop/ball/ball_img_circle18_1_1",a.changeSpImg(t,this.spBall),this.lblName.string=e.size+"mm",this.node.setLocalZOrder(e.index),this.btnUsed.node.active=e.isUsed,this.btnBuy.node.active=!this.btnUsed.node.active,this.spUsedBg.node.active=e.isUsed}}),cc._RF.pop()},{UIMgr:"UIMgr"}],Ball:[function(e,t,i){"use strict";cc._RF.push(t,"90bf7tRwAFHb5QH50wXpR5/","Ball");var a=e("ObserverMgr"),n=e("AudioMgr");cc.Class({extends:cc.Component,properties:{spBall:{displayName:"spBall",default:null,type:cc.Sprite},_pool:null,_hitGround:0},onLoad:function(){this._hitGround=0},start:function(){},initView:function(e,t){this._pool=t;var i=this.node.getComponent(cc.RigidBody),a=i.linearVelocity;a=e,i.linearVelocity=a},onBeginContact:function(e,t,i){switch(i.tag){case 1:if(n.playHitSound(),i.node.getComponent("Block").hit(),24===i.node.getComponent("Block")._type){var s=t.node.getComponent(cc.RigidBody).linearVelocity,o=[0,-Math.PI/6,Math.PI/6],l=Math.floor(cc.rand()%3);s.rotateSelf(o[l]),t.node.getComponent(cc.RigidBody).linearVelocity=s}break;case 2:if(this._hitGround++,this._hitGround>=2){n.playHitSound();var c=this.node.position;this._pool.put(this.node),this._hitGround=0,a.dispatchMsg(GameLocalMsg.Msg.BallEndPos,c)}}}}),cc._RF.pop()},{AudioMgr:"AudioMgr",ObserverMgr:"ObserverMgr"}],Block:[function(e,t,i){"use strict";cc._RF.push(t,"6f6fawe/ydPpZGObdXxAe5r","Block");var a=e("UIMgr"),n=e("GameData"),s=e("GameCfg"),o=e("ObserverMgr");cc.Class({extends:cc.Component,properties:{spBlock:{displayName:"spBlock",default:null,type:cc.Sprite},lblScore:{displayName:"lblScore",default:null,type:cc.Label},_type:null,_index:null,_data1:null,_data2:null,_hp:null,_pool:null,isUsed:!1,xmarkLayout:{displayName:"xmarkLayout",default:null,type:cc.Node},spLeft:{displayName:"spLeft",default:null,type:cc.Sprite},spRight:{displayName:"spRight",default:null,type:cc.Sprite},_isOpen:!0},onLoad:function(){var e=n.stageData;this._data1=e.type.layer1.data,this._data2=e.type.layer2.data,this._hp=0,this.isUsed=!1,this._isOpen=!0},start:function(){},initView:function(e,t,i,n,o){var l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this._pool=n,this._type=e,this._index=t,this.node.setLocalZOrder(t.x);var c="game/game_img_block"+e+"_1";if(-1!==[11,12,13,16,17].indexOf(e)&&(c="game/game_img_block1_1"),11===e||12===e||13===e||20===e||16===e||17===e){this.xmarkLayout.active=!0;var r=.5*this.spLeft.node.parent.width;this.spLeft.node.width=this.spRight.node.width=r,this.spLeft.node.active=this.spRight.node.active=!1,12===e||16===e?(this.spLeft.node.x=.1*r,this.spRight.node.x=-.1*r,this.spLeft.node.active=this.spRight.node.active=!0,this._isOpen=!1):13!==e&&17!==e||(this.spLeft.node.x=.8*-r,this.spRight.node.x=.8*r,this.spLeft.node.active=this.spRight.node.active=!0)}else this.xmarkLayout.active=!1,this.spLeft.node.active=this.spRight.node.active=!1;a.changeSpImg(c,this.spBlock);var d=t.x,h=t.y,u=i.width;this.node.height=this.node.width=u/s.defaultCol,this.node.y=-(this.node.height+.5*this.node.height+this.node.height*d)+o*this.node.height,this.node.x=(h-Math.floor(.5*s.defaultCol))*this.node.width,!1===l?(this._initHp(e,t),this._initPhysics(e,t)):this.lblScore.node.active=!1},_initHp:function(e,t){var i=this._data2[t.x][t.y];-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(e)?(this._hp=9===e||3===e||4===e||5===e||6===e||12===e||13===e||16===e||17===e?parseInt(1*i):11===e?parseInt(2*i):parseInt(e*i),this.refreshHp()):this.lblScore.node.active=!1,this._resetLabelPos(this._type)},_initPhysics:function(e){var t=[],i=.5*this.node.width,a=cc.v2(-i,-i),n=cc.v2(i,-i),s=cc.v2(i,i),o=cc.v2(-i,i);t=3===e?[a,n,o]:4===e?[a,n,s]:5===e?[n,s,o]:6===e?[a,s,o]:[a,n,s,o];var l=null;21===e||22===e||23===e||24===e||7===e||8===e?((l=this.node.addComponent(cc.PhysicsCircleCollider)).sensor=!0,this.node.width=this.node.height=i,l.radius=.5*i):(l=this.node.addComponent(cc.PhysicsPolygonCollider)).points=t,l.tag=1,l.apply()},hit:function(){var e=this;if(-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(this._type)){if(!1===this._isOpen)return;return this._hp--,this.spBlock.node.runAction(cc.sequence(cc.scaleTo(.05,.8),cc.scaleTo(.05,1))),this._hp<=0&&9===this._type&&this.node.parent.children.forEach(function(t){var i=t.getComponent("Block");i._index.x===e._index.x&&i._index.y!==e._index.y&&t.destroy()}),void this.refreshHp()}if(-1!==[21,22,23].indexOf(this._type)){this.node.removeComponent(cc.PhysicsCircleCollider);var t=cc.v2(this.node.x,-this.node.parent.height+.5*this.node.height),i=cc.moveTo(.5,t),a=cc.scaleTo(.5,0);return this.node.runAction(cc.sequence(i,a,cc.removeSelf())),void(n.ballCount+=parseInt(this._type)-20)}return 7===this._type?(this.isUsed=!0,void this.node.parent.children.forEach(function(t){var i=t.getComponent("Block");i._index.x===e._index.x&&-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(i._type)&&(i._hp--,i.refreshHp())})):8===this._type?(this.isUsed=!0,void this.node.parent.children.forEach(function(t){var i=t.getComponent("Block");i._index.y===e._index.y&&-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(i._type)&&(i._hp--,i.refreshHp())})):void(24===this._type&&(this.isUsed=!0))},refreshHp:function(){if(this._hp<=0)return this.node.destroy(),void o.dispatchMsg(GameLocalMsg.Msg.UpdateScore,null);this.lblScore.string=this._hp},_resetLabelPos:function(e){var t=.5*this.node.width,i=.5*this.node.height,a=null;a=3===e?cc.v2(t,i).scaleSelf(cc.v2(-.3,-.3)):4===e?cc.v2(t,i).scaleSelf(cc.v2(.3,-.3)):5===e?cc.v2(t,i).scaleSelf(cc.v2(.3,.3)):6===e?cc.v2(t,i).scaleSelf(cc.v2(-.3,.3)):cc.v2(t,i).scaleSelf(cc.v2(0,0)),this.lblScore.node.position=a},playAct:function(){var e=.5*this.spLeft.node.parent.width;if(this._isOpen){var t=cc.moveBy(.2,cc.v2(-.9*e,0)),i=cc.moveBy(.2,cc.v2(.9*e,0));this.spLeft.node.runAction(t),this.spRight.node.runAction(i)}else{var a=cc.moveBy(.2,cc.v2(.9*e,0)),n=cc.moveBy(.2,cc.v2(-.9*e,0));this.spLeft.node.runAction(a),this.spRight.node.runAction(n)}}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],ButtonClickSound:[function(e,t,i){"use strict";cc._RF.push(t,"00fa0GbWrpGC7tfqeDi2y/I","ButtonClickSound");var a=e("AudioMgr");cc.Class({extends:cc.Component,properties:{clickSound:{displayName:"clickSound",default:null,type:cc.AudioClip}},onLoad:function(){this.node.on("touchstart",function(){this.clickSound?cc.audioEngine.playEffect(this.clickSound,!1):a.playButtonSound()})},start:function(){}}),cc._RF.pop()},{AudioMgr:"AudioMgr"}],ComUIBg:[function(e,t,i){"use strict";cc._RF.push(t,"e80c9ywMZNMy5gb24TRN/f6","ComUIBg"),cc.Class({extends:cc.Component,properties:{bgNode:{displayName:"bgNode",default:null,type:cc.Node}},onLoad:function(){var e=cc.view.getVisibleSize().width,t=cc.view.getVisibleSize().height;this.bgNode.width=e,this.bgNode.height=t},start:function(){},addUI:function(e){var t=cc.instantiate(e);return t.x=t.y=0,this.node.addChild(t),t}}),cc._RF.pop()},{}],End:[function(e,t,i){"use strict";cc._RF.push(t,"c9b86w05HBAULLWVj33t3Xl","End");var a=e("ObserverMgr"),n=e("UIMgr"),s=e("GameCfg"),o=e("GameData"),l=e("AudioMgr");cc.Class({extends:cc.Component,properties:{lblStage:{displayName:"lblStage",default:null,type:cc.Label},lblStatus:{displayName:"lblStatus",default:null,type:cc.Label},spStarArr:[cc.Sprite],btnRetry:{displayName:"btnRetry",default:null,type:cc.Button},btnNext:{displayName:"btnNext",default:null,type:cc.Button},_data:null},start:function(){},initView:function(e){this.spStarArr.forEach(function(e){e.node.active=!1}),this._data=e,this.lblStage.string="\u5173\u5361 "+e.stage,this.lblStatus.string=e.status?"\u901a\u8fc7":"\u5931\u8d25",this.btnNext.node.active=e.status,this.btnRetry.node.active=!this.btnNext.node.active;for(var t=0;t<e.starNum;++t)this.spStarArr[t].node.active=!0;e.status?l.playWinSound():l.playFailSound()},onBtnClickToRetry:function(){a.dispatchMsg(GameLocalMsg.Msg.GoGame,null),n.destroyUI(this)},onBtnClickToNext:function(){var e=this._data.stage,t=parseInt(e)+1;s.saveCurStage(t),o.getStarNum(e)<this._data.starNum&&(o.setStarNum(e,this._data.starNum),s.saveStageCfg(o.gamedata_savelv)),o.initStageData(t),a.dispatchMsg(GameLocalMsg.Msg.GoGame,null),n.destroyUI(this)},onBtnClickToHome:function(){a.dispatchMsg(GameLocalMsg.Msg.GoMenu,null),n.destroyUI(this)}}),cc._RF.pop()},{AudioMgr:"AudioMgr",GameCfg:"GameCfg",GameData:"GameData",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],GameCfg:[function(e,t,i){"use strict";cc._RF.push(t,"9b174brNShIHY6GiYN278LY","GameCfg"),t.exports={width:null,heigth:null,curStage:1,stageCfg:null,defaultCol:11,ballSpeed:2e3,baseScore:10,lineLength:1500,dotCount:20,ballPlusCount:30,totalStar:0,totalRuby:0,init:function(){this.width=cc.view.getVisibleSize().width,this.heigth=cc.view.getVisibleSize().height;var e=cc.sys.localStorage.getItem("CurStage");void 0!==e&&null!==e||(e=1,this.saveCurStage(e)),this.getTotalStar(),this.getTotalRuby()},saveCurStage:function(e){cc.sys.localStorage.setItem("CurStage",e)},getCurStage:function(){return cc.sys.localStorage.getItem("CurStage")},getStageCfg:function(){return JSON.parse(cc.sys.localStorage.getItem("StageCfg"))},saveStageCfg:function(e){cc.sys.localStorage.setItem("StageCfg",JSON.stringify(e))},getTotalStar:function(){var e=0,t=this.getStageCfg();for(var i in t){if(t.hasOwnProperty(i))e+=t[i][1]}return this.totalStar=e,e},getTotalRuby:function(){return this.totalRuby}},cc._RF.pop()},{}],GameData:[function(e,t,i){"use strict";cc._RF.push(t,"414c3IBkbhDco5nAS//o9Sg","GameData"),t.exports={gamedata_savelv:null,mapdata:null,stageData:null,ballCount:null,init:function(){this.gamedata_savelv=null,this.mapdata=null,this.stageData=null},initStageData:function(e){var t=parseInt(e-1);this.stageData=this.mapdata[t].json,this.ballCount=this.gamedata_savelv["stageinfo"+e][0]},getStarNum:function(e){return this.gamedata_savelv["stageinfo"+e][1]},setStarNum:function(e,t){this.gamedata_savelv["stageinfo"+e][1]=t}},cc._RF.pop()},{}],GameLocalMsg:[function(e,t,i){"use strict";cc._RF.push(t,"dfb76QE4xpGtYe+3nEp4w0k","GameLocalMsg"),window.GameLocalMsg={Msg:{GoMenu:"GameLocalMsg.Msg.GoMenu",GoGame:"GameLocalMsg.Msg.GoGame",BallEndPos:"GameLocalMsg.Msg.BallEndPos",CanTouch:"GameLocalMsg.Msg.CanTouch",End:"GameLocalMsg.Msg.End",UpdateScore:"GameLocalMsg.Msg.UpdateScore",Pause:"GameLocalMsg.Msg.Pause",PauseRetry:"GameLocalMsg.Msg.PauseRetry"}},cc._RF.pop()},{}],Game:[function(e,t,i){"use strict";cc._RF.push(t,"510fcdf11NMhauiDYuVJDa+","Game");var a=e("GameCfg"),n=e("GameData"),s=e("UIMgr"),o=e("Observer"),l=e("ObserverMgr");cc.Class({extends:o,properties:{addNode:{displayName:"addNode",default:null,type:cc.Node},_blockPool:null,blockPre:{displayName:"blockPre",default:null,type:cc.Prefab},blockLayer:{displayName:"blockLayer",default:null,type:cc.Node},_data1:null,_data2:null,_leftRow:null,previewPre:{displayName:"previewPre",default:null,type:cc.Prefab},_ballPool:null,ballPre:{displayName:"ballPre",default:null,type:cc.Prefab},_ballCount:null,ballLayer:{displayName:"ballLayer",default:null,type:cc.Node},spBall:{displayName:"spBall",default:null,type:cc.Sprite},lblBallCount:{displayName:"lblBallCount",default:null,type:cc.Label},spBallTemp:{displayName:"spBallTemp",default:null,type:cc.Sprite},lblBallCountTemp:{displayName:"lblBallCountTemp",default:null,type:cc.Label},ballUILayer:{displayName:"ballUILayer",default:null,type:cc.Node},_canTouch:!1,_ballPos:null,_touchP:null,_shootBallCount:null,_ballEndPos:null,backBallLayer:{displayName:"backBallLayer",default:null,type:cc.Node},_backBallCount:null,bottomLayout:{displayName:"bottomLayout",default:null,type:cc.Node},btnBack:{displayName:"btnBack",default:null,type:cc.Button},spWarning:{displayName:"spWarning",default:null,type:cc.Sprite},_killCount:null,_sumScore:null,_maxScore:null,lblTotalScore:{displayName:"lblTotalScore",default:null,type:cc.Label},progressBar:{displayName:"progressBar",default:null,type:cc.ProgressBar},_starNum:0,spStarArr:[cc.Sprite],hintLayer:{displayName:"hintLayer",default:null,type:cc.Node},spHintDot:{displayName:"spHintDot",default:null,type:cc.Sprite},spDot:{displayName:"spDot",default:null,type:cc.Sprite},dotLayout:{displayName:"dotLayout",default:null,type:cc.Node},ballPlusFlag:!1,blockPlusFlag:!1,shopPre:{displayName:"shopPre",default:null,type:cc.Prefab}},_getMsgList:function(){return[GameLocalMsg.Msg.BallEndPos,GameLocalMsg.Msg.CanTouch,GameLocalMsg.Msg.End,GameLocalMsg.Msg.UpdateScore,GameLocalMsg.Msg.PauseRetry]},_onMsg:function(e,t){e===GameLocalMsg.Msg.BallEndPos?(null===this._ballEndPos&&(this._ballEndPos=cc.v2(t.x,this.spBall.node.y),this.spBallTemp.node.active=!0,this.spBallTemp.node.position=this._ballEndPos),this._showBackBall(t)):e===GameLocalMsg.Msg.CanTouch?(this._canTouch=!0,this._starNum=1,this._updateStar()):e===GameLocalMsg.Msg.End?this._close():e===GameLocalMsg.Msg.UpdateScore?(this._killCount++,this._refreshScore()):e===GameLocalMsg.Msg.PauseRetry&&(l.dispatchMsg(GameLocalMsg.Msg.GoGame,null),this._close())},onLoad:function(){this._initMsg(),this._initPhysics(),this._blockPool=new cc.NodePool("Block");for(var e=0;e<121;++e){var t=cc.instantiate(this.blockPre);this._blockPool.put(t)}this.blockLayer.destroyAllChildren(),this._ballPool=new cc.NodePool("Ball");for(var i=0;i<80;++i){var a=cc.instantiate(this.ballPre);this._ballPool.put(a)}},start:function(){},_initPhysics:function(){this.physicsManager=cc.director.getPhysicsManager(),this.physicsManager.enabled=!0},initView:function(){var e=n.stageData;this._data1=e.type.layer1.data,this._data2=e.type.layer2.data;var t=this._data1.length;this._leftRow=t-parseInt(a.defaultCol),this.hintLayer.children.forEach(function(e){e.active=!1});for(var i=0;i<a.dotCount;++i){var s=cc.instantiate(this.spDot.node);this.dotLayout.addChild(s)}this._sumScore=0,this.lblTotalScore.string=this._sumScore,this._calMaxScore(),this.spStarArr.forEach(function(e){e.node.active=!1}),this._reset(),this.blockLayer.destroyAllChildren();for(var o=t-parseInt(a.defaultCol);o<t;++o)for(var l=0;l<a.defaultCol;++l){var c=this._data1[o][l],r=cc.v2(o,l);this._showBlock(c,r,this.blockLayer,this._leftRow)}this._showPreview(this._data1),this._initTouch()},_synBallCount:function(){this._ballCount=n.ballCount},_showBlock:function(e,t,i,a){if(0!==e){var n=this._blockPool.get();n||(n=cc.instantiate(this.blockPre)),i.addChild(n),n.getComponent("Block").initView(e,t,i,this._blockPool,a)}},_showPreview:function(e){s.createPrefab(this.previewPre,function(t,i){this.addNode.addChild(t),i.getComponent("Preview").initView(e,this._blockPool)}.bind(this))},_refreshBallCount:function(){this.lblBallCount.node.active=!0,this.lblBallCount.string="x"+this._ballCount},_initTouch:function(){this._canTouch=!1,this.ballLayer.on("touchstart",function(e){this._canTouch&&(this._hidePhysics(!1),this._touchP=this.ballLayer.convertToNodeSpaceAR(e.getLocation()),this._drawLine(this.spBall.node.position,this._touchP))}.bind(this)),this.ballLayer.on("touchmove",function(e){this._canTouch&&(this._touchP=this.ballLayer.convertToNodeSpaceAR(e.getLocation()),this._hidePhysics(!1),this._drawLine(this.spBall.node.position,this._touchP))}.bind(this)),this.ballLayer.on("touchend",function(e){this._canTouch&&(this.hintLayer.children.forEach(function(e){e.active=!1}),this._hidePhysics(!0),this.spHintDot.node.active=!1,this._canTouch=!1,this._touchP=this.ballLayer.convertToNodeSpaceAR(e.getLocation()),this.schedule(this._shootBall,.2,this._ballCount-1,0),this._showBtnBack())}.bind(this)),this.ballLayer.on("touchcancel",function(e){}.bind(this))},_hidePhysics:function(e){this.blockLayer.children.forEach(function(t){null===t.getComponent(cc.PhysicsCircleCollider)?null===t.getComponent(cc.PhysicsPolygonCollider)||(t.getComponent(cc.PhysicsPolygonCollider).enabled=e):t.getComponent(cc.PhysicsCircleCollider).enabled=e})},_shootBall:function(){this._hideWaring();var e=this._touchP.sub(this._ballPos).normalizeSelf().mul(a.ballSpeed),t=this._ballPool.get();t||(t=cc.instantiate(this.ballPre)),this.ballLayer.addChild(t),t.position=this.spBall.node.position,t.getComponent("Ball").initView(e,this._ballPool),this._refreshCurBallCount()},_drawLine:function(e,t){var i=t.sub(e).normalize(),n=i.angle(cc.v2(1,0));if(!(n<.14||n>3)){var s=i.mul(a.lineLength),o=e,l=e.add(s),c=this.physicsManager.rayCast(this.ballLayer.convertToWorldSpaceAR(o),this.ballLayer.convertToWorldSpaceAR(l))[0],r=c.point,d=c.normal,h=this.ballLayer.convertToNodeSpaceAR(r);this._showHint(h,d,e)}},_showHint:function(e,t,i){this.dotLayout.active=!0,this.spHintDot.node.active=!0,this.spHintDot.node.position=e;var n=e.sub(i).div(.7*a.dotCount),s=.7*a.dotCount;for(var o in this.dotLayout.children)if(this.dotLayout.children.hasOwnProperty(o)){var l=this.dotLayout.children[o];l.position=i.add(n.mul(o)),o>s&&(0===t.y?l.x=this.dotLayout.children[s-(o-s)].x:0===t.x&&(l.y=this.dotLayout.children[s-(o-s)].y))}},_showBackBall:function(e){var t=cc.instantiate(this.spBall.node);this.backBallLayer.addChild(t),t.getChildByName("lblBallCount").active=!1,t.y=this.spBall.node.y,t.x=e.x,e.x!==this._ballEndPos.x||e.y!==this._ballEndPos.y?t.runAction(cc.sequence(cc.moveTo(.1,this._ballEndPos),cc.removeSelf(),cc.callFunc(this._refreshBackBallCount,this))):this._refreshBackBallCount()},_refreshCurBallCount:function(){this._shootBallCount++,this.lblBallCount.string="x"+parseInt(this._ballCount-this._shootBallCount),this._shootBallCount===this._ballCount&&(this.spBall.node.position=this._ballEndPos,this.lblBallCount.node.active=!1)},_refreshBackBallCount:function(){this._backBallCount++,this.lblBallCountTemp.string="x"+this._backBallCount,this._backBallCount===this._ballCount&&(this._reset(),this._moveBlocks())},_reset:function(){this.ballPlusFlag?(this.ballPlusFlag=!1,n.ballCount=n.ballCount-a.ballPlusCount):this.ballPlusCount=!1,this.blockPlusFlag&&(this.blockPlusFlag=!1,this.blockLayer.children.forEach(function(e){"plusBlock"===e.name&&e.destroy()})),this._killCount=0,this._hideWaring(),this._synBallCount(),this._canTouch=!0,this._showUIBall(),this._showBtnBack(),this._ballEndPos=null,this._shootBallCount=0,this._backBallCount=0},_showBall:function(){null!==this._ballEndPos?this.spBall.node.position=this._ballEndPos:(this.spBall.node.y=-this.ballLayer.height+.5*this.spBall.node.height,this.spBall.node.x=0),this._ballPos=this.spBall.node.position,this._refreshBallCount()},_showUIBall:function(){this.spBall.node.active=!!this._canTouch,this.spBallTemp.node.active=!this.spBall.node.active,this._showBall()},_moveBlocks:function(){var e=this.blockLayer.width/a.defaultCol,t=cc.moveBy(.2,cc.p(0,-e)),i=[];this.blockLayer.children.forEach(function(e){if(!0===e.getComponent("Block").isUsed)e.getComponent("Block").isUsed=!1,e.destroy();else{var t=e.getComponent("Block")._index;i.push(t)}});for(var n=this.blockLayer.childrenCount-1;n>=0;--n){var s=this.blockLayer.children[n],o=s.getComponent("Block"),l=o._type,c=o._index.add(cc.v2(1,0));if(-1===[11,12,13,16,17,20].indexOf(l))this._canInclude(c,i)||(o._index.x++,s.runAction(t.clone()));else if(12===l||13===l||16===l||17===l){var r=o._isOpen;o._isOpen=!r,o.playAct()}}if(this._leftRow>0){this._leftRow--;for(var d=this._data1[this._leftRow],h=0;h<a.defaultCol;++h){var u=d[h],p=cc.v2(this._leftRow,h);this._showBlock(u,p,this.blockLayer,this._leftRow)}}this.scheduleOnce(this._refreshEnd,.5)},_canInclude:function(e,t){return t.some(function(t){return t.x===e.x&&t.y===e.y})},_showBtnBack:function(){this.bottomLayout.active=!!this._canTouch,this.btnBack.node.active=!this.bottomLayout.active},onBtnClickToBallBack:function(){var e=this;this._canTouch=!0,this._showBtnBack(),this.unschedule(this._shootBall,this),null===this._ballEndPos&&(this._ballEndPos=this.spBall.node.position),this.ballLayer.children.forEach(function(t){t.removeComponent(cc.PhysicsCircleCollider),t.removeComponent(cc.RigidBody),t.runAction(cc.sequence(cc.moveTo(.1,e._ballEndPos),cc.callFunc(function(){t.destroy()})))}),this.scheduleOnce(function(){e._reset(),e._moveBlocks()},.5)},_refreshEnd:function(){for(var e=this.blockLayer.childrenCount,t=0,i=[1,2,3,4,5,6,9,11,12,13,16,17],a=e-1;a>=0;--a){var n=this.blockLayer.children[a],s=n.getComponent("Block")._type;if(-1!==i.indexOf(s)&&(t++,this._checkWaring(n)))break}(0===e||t<=0)&&this._showEnd(!0)},_checkWaring:function(e){var t=this.blockLayer.width/a.defaultCol,i=this.blockLayer.height,n=Math.abs(i+e.y);return n<=.5*t?(this._showEnd(!1),!0):n>.5*t&&n<1.5*t?(this._showWarning(),!0):void 0},_showWarning:function(){var e=cc.fadeIn(1),t=cc.fadeOut(1);this.spWarning.node.active=!0,this.spWarning.node.runAction(cc.repeatForever(cc.sequence(e,t)))},_hideWaring:function(){this.spWarning.node.stopAllActions(),this.spWarning.node.active=!1},_showEnd:function(e){var t={status:e,stage:a.getCurStage(),starNum:this._starNum};l.dispatchMsg(GameLocalMsg.Msg.End,t)},_close:function(){this._ballPool.clear(),this._blockPool.clear(),s.destroyUI(this)},_calMaxScore:function(){for(var e=[1,2,3,4,5,6,9],t=0,i=this._data1.length,n=this._data2.length,s=0;s<i;++s)for(var o=0;o<n;++o)-1!==e.indexOf(this._data1[s][o])&&t++;for(var l=0;l<t;++l)this._maxScore+=(l+1)*a.baseScore},_refreshScore:function(){this._sumScore+=this._killCount*a.baseScore,this.lblTotalScore.string=this._sumScore,this._updateProgressBar()},_updateProgressBar:function(){this.progressBar.progress=parseFloat(this._sumScore/this._maxScore).toFixed(1),this.progressBar.progress>=.7&&this.progressBar.progress<1?this._starNum=2:this.progressBar.progress>=1&&(this._starNum=3),this._updateStar()},_updateStar:function(){for(var e=this.spStarArr.length,t=0;t<e;++t)t===this._starNum-1&&(this.spStarArr[t].node.active=!0)},onBtnClickToPause:function(){l.dispatchMsg(GameLocalMsg.Msg.Pause,null)},onBtnClickToItem:function(e){switch(e.target.name){case"btnItem0":this.blockLayer.children.forEach(function(e){var t=e.getComponent("Block")._type,i=e.getComponent("Block")._hp;-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(t)&&(e.getComponent("Block")._hp=Math.floor(.5*i),e.getComponent("Block").refreshHp())}),this.scheduleOnce(this._refreshEnd,.5);break;case"btnItem1":this.ballPlusFlag=!0,n.ballCount=n.ballCount+a.ballPlusCount,this._synBallCount(),this._refreshBallCount();break;case"btnItem2":var t=[];this.blockLayer.children.forEach(function(e){var i=e.getComponent("Block")._type;-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(i)&&t.push(e.getLocalZOrder())});var i=Math.max.apply(Math,t);this.blockLayer.children.forEach(function(e){var t=e.getComponent("Block")._type;e.getLocalZOrder()===i&&-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(t)&&e.destroy()}),this.scheduleOnce(this._refreshEnd,.5);break;case"btnItem3":var s=[],o=[];this.blockLayer.children.forEach(function(e){var t=e.getComponent("Block")._type,i=e.getComponent("Block")._index;-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(t)&&(s.push(i.x),o.push(i))});for(var l=Math.max.apply(Math,s),c=Math.min.apply(Math,s),r=0;r<4;++r){var d=0;d=r<2?8:7,this._showUniqueBlock(c,l,o,d)}break;case"btnItem4":this.blockPlusFlag=!0;for(var h=6;h<11;++h){var u=this._blockPool.get();u||(u=cc.instantiate(this.blockPre)),this.blockLayer.addChild(u),u.getComponent("Block").initView(20,cc.v2(0,h),this.blockLayer,this._blockPool,0),u.y=-this.blockLayer.height+.5*u.height,u.name="plusBlock"}}},_showUniqueBlock:function(e,t,i,n){var s=Math.floor(cc.random0To1()*t)+e,o=Math.floor(cc.random0To1()*a.defaultCol),l=cc.v2(s,o);this._canInclude(l,i)?this._showUniqueBlock(e,t,i,n):this._showBlock(n,l,this.blockLayer,0)},onBtnClickToShop:function(){s.createPrefab(this.shopPre,function(e,t){this.addNode.addChild(e),t.getComponent("Shop").initView(1)}.bind(this))}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],GiftItem:[function(e,t,i){"use strict";cc._RF.push(t,"c8de8lM7SxDkKLX1u1I6j29","GiftItem");var a=e("UIMgr");cc.Class({extends:cc.Component,properties:{spType:{displayName:"spType",default:null,type:cc.Sprite},lblRuby:{displayName:"lblRuby",default:null,type:cc.Label},lblItem0:{displayName:"lblItem0",default:null,type:cc.Label},lblItem1:{displayName:"lblItem1",default:null,type:cc.Label}},start:function(){},initView:function(e){var t="shop/ruby/game_img_"+e.type;a.changeSpImg(t,this.spType),this.lblRuby.string="x "+e.num,this.lblItem0.string="x "+e.item0,this.lblItem1.string="x "+e.item1}}),cc._RF.pop()},{UIMgr:"UIMgr"}],Loading:[function(e,t,i){"use strict";cc._RF.push(t,"5b661+0QiNJiLiiU4qcPA1f","Loading");var a=e("GameData"),n=e("GameCfg"),s=e("Observer"),o=e("ObserverMgr"),l=e("UIMgr");cc.Class({extends:s,properties:{},_getMsgList:function(){return[]},_onMsg:function(e,t){},start:function(){cc.loader.loadResDir("map",cc.JsonAsset,function(e,t){if(e)console.log("\u52a0\u8f7d\u5730\u56fejson\u51fa\u9519: ",e);else{var i=t.shift(),s=n.getStageCfg();a.gamedata_savelv=void 0===s||null===s?i.json:s,a.mapdata=t,o.dispatchMsg(GameLocalMsg.Msg.GoMenu,null),this.scheduleOnce(this._close,1)}}.bind(this))},_close:function(){l.destroyUI(this)}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],MainScene:[function(e,t,i){"use strict";cc._RF.push(t,"9fec2kdV4JJvLAo0c3smCYk","MainScene");var a=e("Observer"),n=e("UIMgr"),s=e("GameData"),o=e("GameCfg");cc.Class({extends:a,properties:{addNode:{displayName:"addNode",default:null,type:cc.Node},loadingPre:{displayName:"loadingPre",default:null,type:cc.Prefab},menuPre:{displayName:"menuPre",default:null,type:cc.Prefab},gamePre:{displayName:"gamePre",default:null,type:cc.Prefab},endPre:{displayName:"endPre",default:null,type:cc.Prefab},pausePre:{displayName:"pausePre",default:null,type:cc.Prefab}},_getMsgList:function(){return[GameLocalMsg.Msg.GoMenu,GameLocalMsg.Msg.GoGame,GameLocalMsg.Msg.End,GameLocalMsg.Msg.Pause]},_onMsg:function(e,t){e===GameLocalMsg.Msg.GoMenu?this._initMenu():e===GameLocalMsg.Msg.GoGame?this._initGame():e===GameLocalMsg.Msg.End?this._initEnd(t):e===GameLocalMsg.Msg.Pause&&this._initPause()},onLoad:function(){this._initMsg(),s.init(),o.init()},start:function(){this._initLoading()},_initLoading:function(){n.createPrefab(this.loadingPre,function(e,t){this.addNode.addChild(e)}.bind(this))},_initMenu:function(){n.createPrefab(this.menuPre,function(e,t){this.addNode.addChild(e),t.getComponent("Menu").initView()}.bind(this))},_initGame:function(){n.createPrefab(this.gamePre,function(e,t){this.addNode.addChild(e),t.getComponent("Game").initView()}.bind(this))},_initEnd:function(e){n.createPrefab(this.endPre,function(t,i){this.addNode.addChild(t),i.getComponent("End").initView(e)}.bind(this))},_initPause:function(){n.createPrefab(this.pausePre,function(e,t){this.addNode.addChild(e)}.bind(this))}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",UIMgr:"UIMgr"}],Menu:[function(e,t,i){"use strict";cc._RF.push(t,"80f9eR/jklLmq/GgchEd05w","Menu");var a=e("GameData"),n=e("Observer"),s=e("UIMgr"),o=e("GameCfg"),l=e("SignModule");cc.Class({extends:n,properties:{_stageNodePool:null,stagePre:{displayName:"stagePre",default:null,type:cc.Prefab},scrollView:{displayName:"scrollView",default:null,type:cc.ScrollView},lblRuby:{displayName:"lblRuby",default:null,type:cc.Label},lblTime:{displayName:"lblTime",default:null,type:cc.Label},lblStar:{displayName:"lblStar",default:null,type:cc.Label},_preloadedInterstitial:null,addNode:{displayName:"addNode",default:null,type:cc.Node},shopPre:{displayName:"shopPre",default:null,type:cc.Prefab},signPre:{displayName:"signPre",default:null,type:cc.Prefab},loginTime:null},_getMsgList:function(){return[GameLocalMsg.Msg.GoGame]},_onMsg:function(e,t){e===GameLocalMsg.Msg.GoGame&&this._close()},onLoad:function(){this._initMsg();this._stageNodePool=new cc.NodePool("Stage");for(var e=0;e<30;++e){var t=cc.instantiate(this.stagePre);this._stageNodePool.put(t)}},start:function(){},initView:function(){this._showSign(),this.scrollView.content.destroyAllChildren();for(var e=a.mapdata.length,t=0;t<e;++t){var i=this._stageNodePool.get();i||(i=cc.instantiate(this.stagePre)),this.scrollView.content.addChild(i),i.getComponent("Stage").initView(t+1)}this.lblStar.string=o.totalStar,this.lblRuby.string=o.totalRuby},_close:function(){s.destroyUI(this)},onBtnClickToShareGame:function(){console.log("share>>>: "),console.log('cc.find("canvas"): ',cc.find("canvas")),"undefined"!=typeof FBInstant&&FBInstant.shareAsync({intent:"SHARE",image:this.getImgBase64(),text:"X is asking for your help!",data:{myReplayData:"..."}}).then(function(){console.log("well done: ")})},getImgBase64:function(){var e=cc.find("Canvas"),t=new cc.RenderTexture(1080,1920);t.begin(),e._sgNode.visit(),t.end();var i=document.createElement("canvas"),a=i.getContext("2d");if(i.width=1080,i.height=1920,cc._renderType===cc.game.RENDER_TYPE_CANVAS){var n=t.getSprite().getTexture().getHtmlElementObj();a.drawImage(n,0,0)}else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,s);var o=t.getSprite().getTexture()._glID;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,o,0);var l=new Uint8Array(8294400);gl.readPixels(0,0,1080,1920,gl.RGBA,gl.UNSIGNED_BYTE,l),gl.bindFramebuffer(gl.FRAMEBUFFER,null);for(var c=0;c<1920;c++){var r=1919-c,d=new Uint8ClampedArray(l.buffer,1080*r*4,4320),h=new ImageData(d,1080,1);a.putImageData(h,0,c)}}return i.toDataURL("image/png")},onBtnClickToShowAd:function(){console.log("showAd: "),this._preloadedInterstitial.showAsync().then(function(){console.log("Interstitial ad finished successfully")}).catch(function(e){console.error(e.message)})},captureScreenshot:function(){cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){var e=this,t=document.getElementById("GameCanvas").toDataURL("image/png");cc.director.off(cc.Director.EVENT_AFTER_DRAW),this.base64ToSpriteFrame(t,function(t){e.sprite.spriteFrame=t})}.bind(this))},base64ToSpriteFrame:function(e,t){var i=new Image;i.src=e,i.onload=function(){var e=new cc.Texture2D;e.initWithElement(i),e.handleLoadedTexture();var a=new cc.SpriteFrame(e);t&&t(a)}},onBtnClickToShop:function(e){var t=0;"mainmenu_btn_shop"===e.target.name?t=0:"mainmenu_btn_ball"===e.target.name&&(t=1),s.createPrefab(this.shopPre,function(e,i){this.addNode.addChild(e),i.getComponent("Shop").initView(t)}.bind(this))},onBtnClickToSign:function(){s.createPrefab(this.signPre,function(e,t){this.addNode.addChild(e),t.getComponent("Sign").initView()}.bind(this))},_showSign:function(){l.initSignData(),l.signData.isSigned||s.createPrefab(this.signPre,function(e,t){this.addNode.addChild(e),t.getComponent("Sign").initView()}.bind(this))}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",SignModule:"SignModule",UIMgr:"UIMgr"}],ObserverMgr:[function(e,t,i){"use strict";cc._RF.push(t,"1854fcKNs5AqIfuYH778O5P","ObserverMgr"),t.exports={obsArray:{},addEventListener:function(e,t,i){void 0===i&&console.log("[ObserverMgr] \u6ce8\u518c\u6d88\u606f [%s]:%s \u7684\u4f5c\u7528\u4e8e\u672a\u5b9a\u4e49",e,t.name),void 0===this.obsArray[e]&&(this.obsArray[e]=[]);for(var a=0;a<this.obsArray[e].length;a++){var n=this.obsArray[e][a];if(n.func===t&&n.ob===i)return}this.obsArray[e].push({func:t,ob:i})},removeEventListener:function(e,t,i){var a=!1,n=this.obsArray[e];if(n)for(var s=0;s<n.length;){var o=n[s],l=o.func,c=o.ob;t===l&&i===c?(n.splice(s,1),a=!0):s++}return a},removeEventListenerWithObject:function(e){for(var t in this.obsArray)for(var i=this.obsArray[t],a=0;a<i.length;){i[a].ob===e?i.splice(a,1):a++}},cleanAllEventListener:function(){this.obsArray={}},dispatchMsg:function(e,t){var i=this.obsArray[e];if(void 0!==i)for(var a=0;a<i.length;a++){var n=i[a],s=n.func,o=n.ob;s&&o&&s.apply(o,[e,t])}else console.log("\u6d88\u606f\u5217\u8868\u4e2d\u4e0d\u5b58\u5728: "+e)}},cc._RF.pop()},{}],Observer:[function(e,t,i){"use strict";cc._RF.push(t,"1b995iNs3hBaYFkdjCujf8W","Observer");var a=e("ObserverMgr");cc.Class({extends:cc.Component,_initMsg:function(){for(var e=this._getMsgList(),t=0;t<e.length;t++){var i=e[t];a.addEventListener(i,this._onMsg,this)}},onLoad:function(){},_getMsgList:function(){return[]},_onMsg:function(e,t){},_onError:function(e,t,i){},_onNetOpen:function(){},_onErrorDeal:function(e,t){var i=t[0],a=t[1],n=t[2];this._onError(i,a,n)},onDisable:function(){a.removeEventListenerWithObject(this)},onEnable:function(){},onDestroy:function(){a.removeEventListenerWithObject(this)}}),cc._RF.pop()},{ObserverMgr:"ObserverMgr"}],Pause:[function(e,t,i){"use strict";cc._RF.push(t,"ee964sQPjFG5ZPj4wpAB943","Pause");var a=e("UIMgr"),n=e("ObserverMgr");cc.Class({extends:cc.Component,properties:{},start:function(){},onBtnClickToMenu:function(){n.dispatchMsg(GameLocalMsg.Msg.GoMenu,null),a.destroyUI(this)},onBtnClickToRetry:function(){n.dispatchMsg(GameLocalMsg.Msg.PauseRetry,null),a.destroyUI(this)},onBtnClickToContinue:function(){a.destroyUI(this)}}),cc._RF.pop()},{ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],Preview:[function(e,t,i){"use strict";cc._RF.push(t,"ba501FJe8BLaLHzMn1chAqK","Preview");var a=e("UIMgr"),n=e("GameCfg"),s=e("ObserverMgr");cc.Class({extends:cc.Component,properties:{blockLayer:{displayName:"blockLayer",default:null,type:cc.Node},blockPre:{displayName:"blockPre",default:null,type:cc.Prefab},spBg:{displayName:"spBg",default:null,type:cc.Sprite},_blockPool:null},start:function(){},initView:function(e,t){this._blockPool=t;var i=e.length,a=n.defaultCol,s=this.spBg.node.width/n.defaultCol;this.spBg.node.height=s*i*1.5;for(var o=0;o<i;++o)for(var l=0;l<a;++l){var c=e[o][l],r=cc.v2(o,l);this._showBlock(c,r,this.blockLayer,this._blockPool)}this.scheduleOnce(this._close,3)},_close:function(){s.dispatchMsg(GameLocalMsg.Msg.CanTouch,null),a.destroyUI(this)},_showBlock:function(e,t,i,a){if(0!==e){var n=this._blockPool.get();n||(n=cc.instantiate(this.blockPre)),i.addChild(n),n.getComponent("Block").initView(e,t,i,a,0,!0)}}}),cc._RF.pop()},{GameCfg:"GameCfg",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],RubyItem:[function(e,t,i){"use strict";cc._RF.push(t,"81797ZOxeJNYbDNsReKjzyU","RubyItem");var a=e("UIMgr");cc.Class({extends:cc.Component,properties:{lblType:{displayName:"lblType",default:null,type:cc.Label},spHot:{displayName:"spHot",default:null,type:cc.Sprite},spType:{displayName:"spType",default:null,type:cc.Sprite},lblName:{displayName:"lblName",default:null,type:cc.Label},btnBuy:{displayName:"btnBuy",default:null,type:cc.Button},btnVideo:{displayName:"btnVideo",default:null,type:cc.Button}},start:function(){},initView:function(e){this.lblType.string=e.type,null!==e.typePath?a.changeSpImg(e.typePath,this.spHot):this.spHot.node.active=!1;var t="shop/ruby/game_img_"+e.path;a.changeSpImg(t,this.spType),this.lblName.string=e.name,this.btnVideo.node.active="\u514d\u8d39"===e.type,this.btnBuy.node.active="\u514d\u8d39"!==e.type}}),cc._RF.pop()},{UIMgr:"UIMgr"}],ShopModule:[function(e,t,i){"use strict";cc._RF.push(t,"19070jFMvFHvalWIlIlQGYN","ShopModule"),t.exports={ruby:[{typePath:"shop/ruby/shop_btn_hot",type:"\u70ed\u5356",path:"mzq",name:"\u9ec4\u91d1\u63cf\u51c6"},{typePath:"shop/ruby/shop_btn_hot",type:"\u70ed\u5356",path:"ads_1",name:"\u79fb\u9664\u5e7f\u544a"},{typePath:"shop/ruby/shop_btn_free",type:"\u514d\u8d39",path:"ruby1",name:"20"},{typePath:null,type:"",path:"ruby2",name:"100"},{typePath:null,type:"",path:"ruby3",name:"200"},{typePath:null,type:"",path:"ruby4",name:"300"},{typePath:"shop/ruby/shop_btn_bq",type:"+10%",path:"ruby5",name:"550"},{typePath:"shop/ruby/shop_btn_bq",type:"+15",path:"ruby6",name:"1150"},{typePath:"shop/ruby/shop_btn_bq",type:"+20%",path:"ruby7",name:"3600"},{typePath:"shop/ruby/shop_btn_bq",type:"+25%",path:"ruby8",name:"6250"},{typePath:"shop/ruby/shop_btn_bq",type:"+50%",path:"ruby9",name:"15000"}],ball:[{index:0,type:"circle",size:14,isUsed:!1},{index:1,type:"triangle",size:14,isUsed:!1},{index:2,type:"diamond",size:14,isUsed:!1},{index:3,type:"javelin",size:14,isUsed:!1},{index:4,type:"pentagon",size:14,isUsed:!1},{index:5,type:"star",size:14,isUsed:!1},{index:6,type:"flower",size:14,isUsed:!1},{index:7,type:"circle",size:18,isUsed:!1},{index:8,type:"default",size:18,isUsed:!0},{index:9,type:"triangle",size:18,isUsed:!1},{index:10,type:"diamond",size:18,isUsed:!1},{index:11,type:"javelin",size:18,isUsed:!1},{index:12,type:"pentagon",size:18,isUsed:!1},{index:13,type:"star",size:18,isUsed:!1},{index:14,type:"flower",size:18,isUsed:!1},{index:15,type:"circle",size:22,isUsed:!1},{index:16,type:"triangle",size:22,isUsed:!1},{index:17,type:"diamond",size:22,isUsed:!1},{index:18,type:"javelin",size:22,isUsed:!1},{index:19,type:"pentagon",size:22,isUsed:!1},{index:20,type:"star",size:22,isUsed:!1},{index:21,type:"flower",size:22,isUsed:!1},{index:22,type:"circle",size:26,isUsed:!1},{index:23,type:"triangle",size:26,isUsed:!1},{index:24,type:"diamond",size:26,isUsed:!1},{index:25,type:"javelin",size:26,isUsed:!1},{index:26,type:"pentagon",size:26,isUsed:!1},{index:27,type:"star",size:26,isUsed:!1},{index:28,type:"flower",size:26,isUsed:!1},{index:29,type:"circle",size:30,isUsed:!1},{index:30,type:"triangle",size:30,isUsed:!1},{index:31,type:"diamond",size:30,isUsed:!1},{index:32,type:"javelin",size:30,isUsed:!1},{index:33,type:"pentagon",size:30,isUsed:!1},{index:34,type:"star",size:30,isUsed:!1},{index:35,type:"flower",size:30,isUsed:!1}],gift:[{type:"ruby5",num:5e3,item0:15,item1:15},{type:"ruby7",num:12e3,item0:33,item1:33}]},cc._RF.pop()},{}],Shop:[function(e,t,i){"use strict";cc._RF.push(t,"fd85cSwzaFEz7ud5ENhIr4W","Shop");var a=e("UIMgr"),n=e("ShopModule");cc.Class({extends:cc.Component,properties:{scrollView:{displayName:"scrollView",default:null,type:cc.ScrollView},ballItemPre:{displayName:"ballItemPre",default:null,type:cc.Prefab},rubyItemPre:{displayName:"rubyItemPre",default:null,type:cc.Prefab},giftItemPre:{displayName:"giftItemPre",default:null,type:cc.Prefab},btnRuby:{displayName:"btnRuby",default:null,type:cc.Button},btnBall:{displayName:"btnBall",default:null,type:cc.Button},btnGift:{displayName:"btnGift",default:null,type:cc.Button}},onLoad:function(){},start:function(){},onBtnClickToClose:function(){a.destroyUI(this)},initView:function(e){this._showShadow(e),0===e?this._showRuby():1===e?this._showBall():2===e&&this._showGift()},_showBall:function(){this.scrollView.content.destroyAllChildren();var e=n.ball;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t],a=cc.instantiate(this.ballItemPre);this.scrollView.content.addChild(a),a.getComponent("BallItem").initView(i)}},_showRuby:function(){this.scrollView.content.destroyAllChildren();var e=n.ruby;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t],a=cc.instantiate(this.rubyItemPre);this.scrollView.content.addChild(a),a.getComponent("RubyItem").initView(i)}},_showShadow:function(e){this.btnRuby.node.getChildByName("spShadow").active=0!==e,this.btnBall.node.getChildByName("spShadow").active=1!==e,this.btnGift.node.getChildByName("spShadow").active=2!==e},_showGift:function(){this.scrollView.content.destroyAllChildren();var e=n.gift;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t],a=cc.instantiate(this.giftItemPre);this.scrollView.content.addChild(a),a.getComponent("GiftItem").initView(i)}},onBtnClickToSubItem:function(e){if(e.target.getChildByName("spShadow").active){var t=0;"btnRuby"===e.target.name?t=0:"btnBall"===e.target.name?t=1:"btnGift"===e.target.name&&(t=2),this.initView(t)}}}),cc._RF.pop()},{ShopModule:"ShopModule",UIMgr:"UIMgr"}],SignModule:[function(e,t,i){"use strict";cc._RF.push(t,"03b6eMPSb1MkKNqWGgd1iTq","SignModule"),t.exports={signData:null,reward:{day0:{isChecked:!1},day1:{isChecked:!1},day2:{isChecked:!1},day3:{isChecked:!1},day4:{isChecked:!1},day5:{isChecked:!1},day6:{isChecked:!1}},initSignData:function(){return this.signData=JSON.parse(cc.sys.localStorage.getItem("Sign")),null!==this.signData&&void 0!==this.signData||(this.signData={isSigned:!1,time:dayjs(),reward:this.reward},this.saveSignData(this.signData)),this.signData},saveSignData:function(e){cc.sys.localStorage.setItem("Sign",JSON.stringify(e))}},cc._RF.pop()},{}],Sign:[function(e,t,i){"use strict";cc._RF.push(t,"4d2b2kePsJIG5DM6BCV1xHw","Sign");var a=e("UIMgr"),n=e("SignModule");cc.Class({extends:cc.Component,properties:{spDayArr:[cc.Sprite],_rewardArr:[],btnGot:{displayName:"btnGot",default:null,type:cc.Button},btnDoubleGot:{displayName:"btnDoubleGot",default:null,type:cc.Button}},onLoad:function(){},start:function(){},initView:function(){for(var e in this._rewardArr=[],n.signData.reward)if(n.signData.reward.hasOwnProperty(e)){var t=n.signData.reward[e];this._rewardArr.push(t)}for(var i in this._rewardArr)if(this._rewardArr.hasOwnProperty(i)){var a=this._rewardArr[i];this.spDayArr[i].node.getChildByName("check").active=this.spDayArr[i].node.getChildByName("spCheckBg").active=a.isChecked}this.btnGot.interactable=this.btnDoubleGot.interactable=!n.signData.isSigned},onBtnClickToClose:function(){a.destroyUI(this)},onBtnClickToGot:function(){var e=dayjs().day(),t=parseInt(e-1);n.signData.reward["day"+t].isChecked=!0,n.signData.isSigned=!0,n.saveSignData(n.signData),n.reward=n.signData.reward,this.initView()}}),cc._RF.pop()},{SignModule:"SignModule",UIMgr:"UIMgr"}],Stage:[function(e,t,i){"use strict";cc._RF.push(t,"1bd57as/OdGGqNjyCMrgJlW","Stage");var a=e("GameCfg"),n=e("UIMgr"),s=e("ObserverMgr"),o=e("GameData");cc.Class({extends:cc.Component,properties:{spStage:{displayName:"spStage",default:null,type:cc.Sprite},lblStage:{displayName:"lblStage",default:null,type:cc.Label},_index:null,_canChoose:!1,starArr:[cc.Sprite]},onLoad:function(){this._canChoose=!1,this.lblStage.node.active=!1,this.starArr.forEach(function(e){e.node.active=!1})},start:function(){},initView:function(e){if(this._index=e,a.getCurStage()>=e){this._canChoose=!0,this.lblStage.node.active=!0,this.lblStage.string=e;n.changeSpImg("menu/mainmenu_img_stageunlockbg",this.spStage);var t=o.getStarNum(e);if(void 0===t)return;this._showStageStar(t)}},_showStageStar:function(e){for(var t=0;t<e;++t)this.starArr[t].node.active=!0},onBtnClickToStage:function(){this._canChoose&&(o.initStageData(this._index),s.dispatchMsg(GameLocalMsg.Msg.GoGame,null))}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],UIMgr:[function(e,t,i){"use strict";cc._RF.push(t,"73f81Ikm3NJvIaB1fgU1TS5","UIMgr"),t.exports={_uiMap:{},createPrefabAddToRunningScene:function(e,t){var i=this;e?cc.loader.loadRes("common/prefab/ComUIBg",function(a,n){var s=cc.instantiate(n),o=s.getComponent("ComUIBg");if(o){var l=o.addUI(e),c=l.uuid.toString();cc.log("add uuid: "+c),i._uiMap[c]=s;var r=cc.director.getScene();if(r){var d=cc.view.getVisibleSize().width,h=cc.view.getVisibleSize().height;return s.x=d/2,s.y=h/2,r.addChild(s),void(t&&t(l))}cc.log("[UIMgr] \u6ca1\u6709\u8fd0\u884cScene,\u65e0\u6cd5\u6dfb\u52a0ui\u754c\u9762\uff01")}}):cc.log("[UIMgr] \u65e0\u6cd5\u521b\u5efaPrefab\uff1a"+e)},destroyUI:function(e){if(e){if(e.node){var t=e.node.uuid.toString(),i=this._uiMap[t];return i?(i.destroy(),void(this._uiMap[e.node.uuid.toString()]=null)):void cc.log("[UIMgr] "+e.name+" \u6ca1\u6709node\u5c5e\u6027")}cc.log("[UIMgr] "+e.name+" \u6ca1\u6709node\u5c5e\u6027")}else cc.log("[UIMgr] \u7f3a\u5c11\u53c2\u6570")},createPrefab:function(e,t){var i=this;e?cc.loader.loadRes("common/prefab/ComUIBg",function(a,n){if(a)cc.log(a.errorMessage);else{var s=cc.instantiate(n),o=s.getComponent("ComUIBg");if(o){var l=o.addUI(e),c=l.uuid.toString();i._uiMap[c]=s,t&&t(s,l)}}}):cc.log("[UIMgr] \u65e0\u6cd5\u521b\u5efaPrefab\uff1a"+e)},changeSpImg:function(e,t){cc.loader.loadRes(e,cc.SpriteFrame,function(e,i){e?console.log("\u66f4\u6362\u56fe\u7247\u9519\u8bef: ",e):t.spriteFrame=i})}},cc._RF.pop()},{}]},{},["Observer","ObserverMgr","ComUIBg","UIMgr","MainScene","AudioMgr","ButtonClickSound","End","Ball","Block","Game","Preview","GameCfg","GameData","Loading","Menu","Sign","SignModule","Stage","GameLocalMsg","Pause","BallItem","GiftItem","RubyItem","Shop","ShopModule"]);