__require=function t(e,i,a){function o(n,l){if(!i[n]){if(!e[n]){var c=n.split("/");if(c=c[c.length-1],!e[c]){var r="function"==typeof __require&&__require;if(!l&&r)return r(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+n+"'")}}var h=i[n]={exports:{}};e[n][0].call(h.exports,function(t){return o(e[n][1][t]||t)},h,h.exports,t,e,i,a)}return i[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<a.length;n++)o(a[n]);return o}({AudioMgr:[function(t,e,i){"use strict";cc._RF.push(e,"1c5e5Nl/BRJTb0A4uTojjJF","AudioMgr"),e.exports={_bgMusic:null,_guideMusic:null,playButtonSound:function(){cc.loader.loadRes("sound/btn",cc.AudioClip,function(t,e){cc.audioEngine.play(e)})},playHitSound:function(){cc.loader.loadRes("sound/hit",cc.AudioClip,function(t,e){cc.audioEngine.play(e)})},playWinSound:function(){cc.loader.loadRes("sound/win",cc.AudioClip,function(t,e){cc.audioEngine.play(e)})},playFailSound:function(){cc.loader.loadRes("sound/fail",cc.AudioClip,function(t,e){cc.audioEngine.play(e)})},playMainMusic:function(){cc.loader.loadRes("sound/bg",cc.AudioClip,function(t,e){this._bgMusic=cc.audioEngine.play(e,!0)}.bind(this))},stopCurrentBackgroundMusic:function(){null!==this._bgMusic&&(cc.audioEngine.stop(this._bgMusic),this._bgMusic=null)},playEffectMusic:function(t,e){void 0===e&&(e=!1),cc.loader.loadRes(t,cc.AudioClip,function(t,i){cc.audioEngine.playEffect(i,e)})}},cc._RF.pop()},{}],Ball:[function(t,e,i){"use strict";cc._RF.push(e,"90bf7tRwAFHb5QH50wXpR5/","Ball");var a=t("ObserverMgr"),o=t("AudioMgr");cc.Class({extends:cc.Component,properties:{spBall:{displayName:"spBall",default:null,type:cc.Sprite},_pool:null,_hitGround:0},onLoad:function(){this._hitGround=0},start:function(){},initView:function(t,e){this._pool=e;var i=this.node.getComponent(cc.RigidBody),a=i.linearVelocity;a=t,i.linearVelocity=a},onBeginContact:function(t,e,i){switch(i.tag){case 1:if(o.playHitSound(),i.node.getComponent("Block").hit(),24===i.node.getComponent("Block")._type){var s=e.node.getComponent(cc.RigidBody).linearVelocity,n=[0,-Math.PI/6,Math.PI/6],l=Math.floor(cc.rand()%3);s.rotateSelf(n[l]),e.node.getComponent(cc.RigidBody).linearVelocity=s}break;case 2:if(this._hitGround++,this._hitGround>=2){o.playHitSound();var c=this.node.position;this._pool.put(this.node),this._hitGround=0,a.dispatchMsg(GameLocalMsg.Msg.BallEndPos,c)}}}}),cc._RF.pop()},{AudioMgr:"AudioMgr",ObserverMgr:"ObserverMgr"}],Block:[function(t,e,i){"use strict";cc._RF.push(e,"6f6fawe/ydPpZGObdXxAe5r","Block");var a=t("UIMgr"),o=t("GameData"),s=t("GameCfg"),n=t("ObserverMgr");cc.Class({extends:cc.Component,properties:{spBlock:{displayName:"spBlock",default:null,type:cc.Sprite},lblScore:{displayName:"lblScore",default:null,type:cc.Label},_type:null,_index:null,_data1:null,_data2:null,_hp:null,_pool:null,isUsed:!1,xmarkLayout:{displayName:"xmarkLayout",default:null,type:cc.Node},spLeft:{displayName:"spLeft",default:null,type:cc.Sprite},spRight:{displayName:"spRight",default:null,type:cc.Sprite},_isOpen:!0},onLoad:function(){var t=o.stageData;this._data1=t.type.layer1.data,this._data2=t.type.layer2.data,this._hp=0,this.isUsed=!1,this._isOpen=!0},start:function(){},initView:function(t,e,i,o,n){var l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this._pool=o,this._type=t,this._index=e,this.node.setLocalZOrder(e.x);var c="game/game_img_block"+t+"_1";if(-1!==[11,12,13,16,17].indexOf(t)&&(c="game/game_img_block1_1"),11===t||12===t||13===t||20===t||16===t||17===t){this.xmarkLayout.active=!0;var r=.5*this.spLeft.node.parent.width;this.spLeft.node.width=this.spRight.node.width=r,this.spLeft.node.active=this.spRight.node.active=!1,12===t||16===t?(this.spLeft.node.x=.1*r,this.spRight.node.x=-.1*r,this.spLeft.node.active=this.spRight.node.active=!0,this._isOpen=!1):13!==t&&17!==t||(this.spLeft.node.x=.8*-r,this.spRight.node.x=.8*r,this.spLeft.node.active=this.spRight.node.active=!0)}else this.xmarkLayout.active=!1,this.spLeft.node.active=this.spRight.node.active=!1;a.changeSpImg(c,this.spBlock);var h=e.x,u=e.y,d=i.width;this.node.height=this.node.width=d/s.defaultCol,this.node.y=-(this.node.height+.5*this.node.height+this.node.height*h)+n*this.node.height,this.node.x=(u-Math.floor(.5*s.defaultCol))*this.node.width,!1===l?(this._initHp(t,e),this._initPhysics(t,e)):this.lblScore.node.active=!1},_initHp:function(t,e){var i=this._data2[e.x][e.y];-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(t)?(this._hp=9===t||3===t||4===t||5===t||6===t||12===t||13===t||16===t||17===t?parseInt(1*i):11===t?parseInt(2*i):parseInt(t*i),this.refreshHp()):this.lblScore.node.active=!1,this._resetLabelPos(this._type)},_initPhysics:function(t){var e=[],i=.5*this.node.width,a=cc.v2(-i,-i),o=cc.v2(i,-i),s=cc.v2(i,i),n=cc.v2(-i,i);e=3===t?[a,o,n]:4===t?[a,o,s]:5===t?[o,s,n]:6===t?[a,s,n]:[a,o,s,n];var l=null;21===t||22===t||23===t||24===t||7===t||8===t?((l=this.node.addComponent(cc.PhysicsCircleCollider)).sensor=!0,this.node.width=this.node.height=i,l.radius=.5*i):(l=this.node.addComponent(cc.PhysicsPolygonCollider)).points=e,l.tag=1,l.apply()},hit:function(){var t=this;if(-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(this._type)){if(!1===this._isOpen)return;return this._hp--,this._hp<=0&&9===this._type&&this.node.parent.children.forEach(function(e){var i=e.getComponent("Block");i._index.x===t._index.x&&i._index.y!==t._index.y&&e.destroy()}),void this.refreshHp()}if(-1!==[21,22,23].indexOf(this._type)){this.node.removeComponent(cc.PhysicsCircleCollider);var e=cc.v2(this.node.x,-this.node.parent.height+.5*this.node.height),i=cc.moveTo(.5,e),a=cc.scaleTo(.5,0);return this.node.runAction(cc.sequence(i,a,cc.removeSelf())),void(o.ballCount+=parseInt(this._type)-20)}return 7===this._type?(this.isUsed=!0,void this.node.parent.children.forEach(function(e){var i=e.getComponent("Block");i._index.x===t._index.x&&-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(i._type)&&(i._hp--,i.refreshHp())})):8===this._type?(this.isUsed=!0,void this.node.parent.children.forEach(function(e){var i=e.getComponent("Block");i._index.y===t._index.y&&-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(i._type)&&(i._hp--,i.refreshHp())})):void(24===this._type&&(this.isUsed=!0))},refreshHp:function(){if(this._hp<=0)return this.node.destroy(),void n.dispatchMsg(GameLocalMsg.Msg.UpdateScore,null);this.lblScore.string=this._hp},_resetLabelPos:function(t){var e=.5*this.node.width,i=.5*this.node.height,a=null;a=3===t?cc.v2(e,i).scaleSelf(cc.v2(-.3,-.3)):4===t?cc.v2(e,i).scaleSelf(cc.v2(.3,-.3)):5===t?cc.v2(e,i).scaleSelf(cc.v2(.3,.3)):6===t?cc.v2(e,i).scaleSelf(cc.v2(-.3,.3)):cc.v2(e,i).scaleSelf(cc.v2(0,0)),this.lblScore.node.position=a},playAct:function(){var t=.5*this.spLeft.node.parent.width;if(this._isOpen){var e=cc.moveBy(.2,cc.v2(-.9*t,0)),i=cc.moveBy(.2,cc.v2(.9*t,0));this.spLeft.node.runAction(e),this.spRight.node.runAction(i)}else{var a=cc.moveBy(.2,cc.v2(.9*t,0)),o=cc.moveBy(.2,cc.v2(-.9*t,0));this.spLeft.node.runAction(a),this.spRight.node.runAction(o)}}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],ButtonClickSound:[function(t,e,i){"use strict";cc._RF.push(e,"00fa0GbWrpGC7tfqeDi2y/I","ButtonClickSound");var a=t("AudioMgr");cc.Class({extends:cc.Component,properties:{clickSound:{displayName:"clickSound",default:null,type:cc.AudioClip}},onLoad:function(){this.node.on("touchstart",function(){this.clickSound?cc.audioEngine.playEffect(this.clickSound,!1):a.playButtonSound()})},start:function(){}}),cc._RF.pop()},{AudioMgr:"AudioMgr"}],ComUIBg:[function(t,e,i){"use strict";cc._RF.push(e,"e80c9ywMZNMy5gb24TRN/f6","ComUIBg"),cc.Class({extends:cc.Component,properties:{bgNode:{displayName:"bgNode",default:null,type:cc.Node}},onLoad:function(){var t=cc.view.getVisibleSize().width,e=cc.view.getVisibleSize().height;this.bgNode.width=t,this.bgNode.height=e},start:function(){},addUI:function(t){var e=cc.instantiate(t);return e.x=e.y=0,this.node.addChild(e),e}}),cc._RF.pop()},{}],End:[function(t,e,i){"use strict";cc._RF.push(e,"c9b86w05HBAULLWVj33t3Xl","End");var a=t("ObserverMgr"),o=t("UIMgr"),s=t("GameCfg"),n=t("GameData"),l=t("AudioMgr");cc.Class({extends:cc.Component,properties:{lblStage:{displayName:"lblStage",default:null,type:cc.Label},lblStatus:{displayName:"lblStatus",default:null,type:cc.Label},spStarArr:[cc.Sprite],btnRetry:{displayName:"btnRetry",default:null,type:cc.Button},btnNext:{displayName:"btnNext",default:null,type:cc.Button},_data:null},start:function(){},initView:function(t){this.spStarArr.forEach(function(t){t.node.active=!1}),this._data=t,this.lblStage.string="\u5173\u5361 "+t.stage,this.lblStatus.string=t.status?"\u901a\u8fc7":"\u5931\u8d25",this.btnNext.node.active=t.status,this.btnRetry.node.active=!this.btnNext.node.active;for(var e=0;e<t.starNum;++e)this.spStarArr[e].node.active=!0;t.status?l.playWinSound():l.playFailSound()},onBtnClickToRetry:function(){a.dispatchMsg(GameLocalMsg.Msg.GoGame,null),o.destroyUI(this)},onBtnClickToNext:function(){var t=this._data.stage,e=parseInt(t)+1;s.saveCurStage(e),n.getStarNum(t)<this._data.starNum&&(n.setStarNum(t,this._data.starNum),s.saveStageCfg(n.gamedata_savelv)),n.initStageData(e),a.dispatchMsg(GameLocalMsg.Msg.GoGame,null),o.destroyUI(this)},onBtnClickToHome:function(){a.dispatchMsg(GameLocalMsg.Msg.GoMenu,null),o.destroyUI(this)}}),cc._RF.pop()},{AudioMgr:"AudioMgr",GameCfg:"GameCfg",GameData:"GameData",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],GameCfg:[function(t,e,i){"use strict";cc._RF.push(e,"9b174brNShIHY6GiYN278LY","GameCfg"),e.exports={width:null,heigth:null,curStage:1,stageCfg:null,defaultCol:11,ballSpeed:2e3,baseScore:10,lineLength:1500,dotCount:20,ballPlusCount:30,totalStar:0,totalRuby:0,init:function(){this.width=cc.view.getVisibleSize().width,this.heigth=cc.view.getVisibleSize().height;var t=cc.sys.localStorage.getItem("CurStage");void 0!==t&&null!==t||(t=1,this.saveCurStage(t)),this.getTotalStar(),this.getTotalRuby()},saveCurStage:function(t){cc.sys.localStorage.setItem("CurStage",t)},getCurStage:function(){return cc.sys.localStorage.getItem("CurStage")},getStageCfg:function(){return JSON.parse(cc.sys.localStorage.getItem("StageCfg"))},saveStageCfg:function(t){cc.sys.localStorage.setItem("StageCfg",JSON.stringify(t))},getTotalStar:function(){var t=0,e=this.getStageCfg();for(var i in e){if(e.hasOwnProperty(i))t+=e[i][1]}return this.totalStar=t,t},getTotalRuby:function(){return this.totalRuby}},cc._RF.pop()},{}],GameData:[function(t,e,i){"use strict";cc._RF.push(e,"414c3IBkbhDco5nAS//o9Sg","GameData"),e.exports={gamedata_savelv:null,mapdata:null,stageData:null,ballCount:null,init:function(){this.gamedata_savelv=null,this.mapdata=null,this.stageData=null},initStageData:function(t){var e=parseInt(t-1);this.stageData=this.mapdata[e].json,this.ballCount=this.gamedata_savelv["stageinfo"+t][0]},getStarNum:function(t){return this.gamedata_savelv["stageinfo"+t][1]},setStarNum:function(t,e){this.gamedata_savelv["stageinfo"+t][1]=e}},cc._RF.pop()},{}],GameLocalMsg:[function(t,e,i){"use strict";cc._RF.push(e,"dfb76QE4xpGtYe+3nEp4w0k","GameLocalMsg"),window.GameLocalMsg={Msg:{GoMenu:"GameLocalMsg.Msg.GoMenu",GoGame:"GameLocalMsg.Msg.GoGame",BallEndPos:"GameLocalMsg.Msg.BallEndPos",CanTouch:"GameLocalMsg.Msg.CanTouch",End:"GameLocalMsg.Msg.End",UpdateScore:"GameLocalMsg.Msg.UpdateScore",Pause:"GameLocalMsg.Msg.Pause",PauseRetry:"GameLocalMsg.Msg.PauseRetry"}},cc._RF.pop()},{}],Game:[function(t,e,i){"use strict";cc._RF.push(e,"510fcdf11NMhauiDYuVJDa+","Game");var a=t("GameCfg"),o=t("GameData"),s=t("UIMgr"),n=t("Observer"),l=t("ObserverMgr");cc.Class({extends:n,properties:{addNode:{displayName:"addNode",default:null,type:cc.Node},_blockPool:null,blockPre:{displayName:"blockPre",default:null,type:cc.Prefab},blockLayer:{displayName:"blockLayer",default:null,type:cc.Node},_data1:null,_data2:null,_leftRow:null,previewPre:{displayName:"previewPre",default:null,type:cc.Prefab},_ballPool:null,ballPre:{displayName:"ballPre",default:null,type:cc.Prefab},_ballCount:null,ballLayer:{displayName:"ballLayer",default:null,type:cc.Node},spBall:{displayName:"spBall",default:null,type:cc.Sprite},lblBallCount:{displayName:"lblBallCount",default:null,type:cc.Label},spBallTemp:{displayName:"spBallTemp",default:null,type:cc.Sprite},lblBallCountTemp:{displayName:"lblBallCountTemp",default:null,type:cc.Label},ballUILayer:{displayName:"ballUILayer",default:null,type:cc.Node},_canTouch:!1,_ballPos:null,_touchP:null,_shootBallCount:null,_ballEndPos:null,backBallLayer:{displayName:"backBallLayer",default:null,type:cc.Node},_backBallCount:null,bottomLayout:{displayName:"bottomLayout",default:null,type:cc.Node},btnBack:{displayName:"btnBack",default:null,type:cc.Button},spWarning:{displayName:"spWarning",default:null,type:cc.Sprite},_killCount:null,_sumScore:null,_maxScore:null,lblTotalScore:{displayName:"lblTotalScore",default:null,type:cc.Label},progressBar:{displayName:"progressBar",default:null,type:cc.ProgressBar},_starNum:0,spStarArr:[cc.Sprite],hintLayer:{displayName:"hintLayer",default:null,type:cc.Node},spHintDot:{displayName:"spHintDot",default:null,type:cc.Sprite},spDot:{displayName:"spDot",default:null,type:cc.Sprite},dotLayout:{displayName:"dotLayout",default:null,type:cc.Node},ballPlusFlag:!1,blockPlusFlag:!1},_getMsgList:function(){return[GameLocalMsg.Msg.BallEndPos,GameLocalMsg.Msg.CanTouch,GameLocalMsg.Msg.End,GameLocalMsg.Msg.UpdateScore,GameLocalMsg.Msg.PauseRetry]},_onMsg:function(t,e){t===GameLocalMsg.Msg.BallEndPos?(null===this._ballEndPos&&(this._ballEndPos=cc.v2(e.x,this.spBall.node.y),this.spBallTemp.node.active=!0,this.spBallTemp.node.position=this._ballEndPos),this._showBackBall(e)):t===GameLocalMsg.Msg.CanTouch?(this._canTouch=!0,this._starNum=1,this._updateStar()):t===GameLocalMsg.Msg.End?this._close():t===GameLocalMsg.Msg.UpdateScore?(this._killCount++,this._refreshScore()):t===GameLocalMsg.Msg.PauseRetry&&(l.dispatchMsg(GameLocalMsg.Msg.GoGame,null),this._close())},onLoad:function(){this._initMsg(),this._initPhysics(),this._blockPool=new cc.NodePool("Block");for(var t=0;t<121;++t){var e=cc.instantiate(this.blockPre);this._blockPool.put(e)}this.blockLayer.destroyAllChildren(),this._ballPool=new cc.NodePool("Ball");for(var i=0;i<80;++i){var a=cc.instantiate(this.ballPre);this._ballPool.put(a)}},start:function(){},_initPhysics:function(){this.physicsManager=cc.director.getPhysicsManager(),this.physicsManager.enabled=!0},initView:function(){var t=o.stageData;this._data1=t.type.layer1.data,this._data2=t.type.layer2.data;var e=this._data1.length;this._leftRow=e-parseInt(a.defaultCol),this.hintLayer.children.forEach(function(t){t.active=!1});for(var i=0;i<a.dotCount;++i){var s=cc.instantiate(this.spDot.node);this.dotLayout.addChild(s)}this._sumScore=0,this.lblTotalScore.string=this._sumScore,this._calMaxScore(),this.spStarArr.forEach(function(t){t.node.active=!1}),this._reset(),this.blockLayer.destroyAllChildren();for(var n=e-parseInt(a.defaultCol);n<e;++n)for(var l=0;l<a.defaultCol;++l){var c=this._data1[n][l],r=cc.v2(n,l);this._showBlock(c,r,this.blockLayer,this._leftRow)}this._showPreview(this._data1),this._initTouch()},_synBallCount:function(){this._ballCount=o.ballCount},_showBlock:function(t,e,i,a){if(0!==t){var o=this._blockPool.get();o||(o=cc.instantiate(this.blockPre)),i.addChild(o),o.getComponent("Block").initView(t,e,i,this._blockPool,a)}},_showPreview:function(t){s.createPrefab(this.previewPre,function(e,i){this.addNode.addChild(e),i.getComponent("Preview").initView(t,this._blockPool)}.bind(this))},_refreshBallCount:function(){this.lblBallCount.node.active=!0,this.lblBallCount.string="x"+this._ballCount},_initTouch:function(){this._canTouch=!1,this.ballLayer.on("touchstart",function(t){this._canTouch&&(this._hidePhysics(!1),this._touchP=this.ballLayer.convertToNodeSpaceAR(t.getLocation()),this._drawLine(this.spBall.node.position,this._touchP))}.bind(this)),this.ballLayer.on("touchmove",function(t){this._canTouch&&(this._touchP=this.ballLayer.convertToNodeSpaceAR(t.getLocation()),this._hidePhysics(!1),this._drawLine(this.spBall.node.position,this._touchP))}.bind(this)),this.ballLayer.on("touchend",function(t){this._canTouch&&(this.hintLayer.children.forEach(function(t){t.active=!1}),this._hidePhysics(!0),this.spHintDot.node.active=!1,this._canTouch=!1,this._touchP=this.ballLayer.convertToNodeSpaceAR(t.getLocation()),this.schedule(this._shootBall,.2,this._ballCount-1,0),this._showBtnBack())}.bind(this)),this.ballLayer.on("touchcancel",function(t){}.bind(this))},_hidePhysics:function(t){this.blockLayer.children.forEach(function(e){null===e.getComponent(cc.PhysicsCircleCollider)?null===e.getComponent(cc.PhysicsPolygonCollider)||(e.getComponent(cc.PhysicsPolygonCollider).enabled=t):e.getComponent(cc.PhysicsCircleCollider).enabled=t})},_shootBall:function(){this._hideWaring();var t=this._touchP.sub(this._ballPos).normalizeSelf().mul(a.ballSpeed),e=this._ballPool.get();e||(e=cc.instantiate(this.ballPre)),this.ballLayer.addChild(e),e.position=this.spBall.node.position,e.getComponent("Ball").initView(t,this._ballPool),this._refreshCurBallCount()},_drawLine:function(t,e){var i=e.sub(t).normalize(),o=i.angle(cc.v2(1,0));if(!(o<.14||o>3)){var s=i.mul(a.lineLength),n=t,l=t.add(s),c=this.physicsManager.rayCast(this.ballLayer.convertToWorldSpaceAR(n),this.ballLayer.convertToWorldSpaceAR(l))[0],r=c.point,h=c.normal,u=this.ballLayer.convertToNodeSpaceAR(r);this._showHint(u,h,t)}},_showHint:function(t,e,i){this.dotLayout.active=!0,this.spHintDot.node.active=!0,this.spHintDot.node.position=t;var o=t.sub(i).div(.7*a.dotCount),s=.7*a.dotCount;for(var n in this.dotLayout.children)if(this.dotLayout.children.hasOwnProperty(n)){var l=this.dotLayout.children[n];l.position=i.add(o.mul(n)),n>s&&(0===e.y?l.x=this.dotLayout.children[s-(n-s)].x:0===e.x&&(l.y=this.dotLayout.children[s-(n-s)].y))}},_showBackBall:function(t){var e=cc.instantiate(this.spBall.node);this.backBallLayer.addChild(e),e.getChildByName("lblBallCount").active=!1,e.y=this.spBall.node.y,e.x=t.x,t.x!==this._ballEndPos.x||t.y!==this._ballEndPos.y?e.runAction(cc.sequence(cc.moveTo(.1,this._ballEndPos),cc.removeSelf(),cc.callFunc(this._refreshBackBallCount,this))):this._refreshBackBallCount()},_refreshCurBallCount:function(){this._shootBallCount++,this.lblBallCount.string="x"+parseInt(this._ballCount-this._shootBallCount),this._shootBallCount===this._ballCount&&(this.spBall.node.position=this._ballEndPos,this.lblBallCount.node.active=!1)},_refreshBackBallCount:function(){this._backBallCount++,this.lblBallCountTemp.string="x"+this._backBallCount,this._backBallCount===this._ballCount&&(this._reset(),this._moveBlocks())},_reset:function(){this.ballPlusFlag?(this.ballPlusFlag=!1,o.ballCount=o.ballCount-a.ballPlusCount):this.ballPlusCount=!1,this.blockPlusFlag&&(this.blockPlusFlag=!1,this.blockLayer.children.forEach(function(t){"plusBlock"===t.name&&t.destroy()})),this._killCount=0,this._hideWaring(),this._synBallCount(),this._canTouch=!0,this._showUIBall(),this._showBtnBack(),this._ballEndPos=null,this._shootBallCount=0,this._backBallCount=0},_showBall:function(){null!==this._ballEndPos?this.spBall.node.position=this._ballEndPos:(this.spBall.node.y=-this.ballLayer.height+.5*this.spBall.node.height,this.spBall.node.x=0),this._ballPos=this.spBall.node.position,this._refreshBallCount()},_showUIBall:function(){this.spBall.node.active=!!this._canTouch,this.spBallTemp.node.active=!this.spBall.node.active,this._showBall()},_moveBlocks:function(){var t=this.blockLayer.width/a.defaultCol,e=cc.moveBy(.2,cc.p(0,-t)),i=[];this.blockLayer.children.forEach(function(t){if(!0===t.getComponent("Block").isUsed)t.getComponent("Block").isUsed=!1,t.destroy();else{var e=t.getComponent("Block")._index;i.push(e)}});for(var o=this.blockLayer.childrenCount-1;o>=0;--o){var s=this.blockLayer.children[o],n=s.getComponent("Block"),l=n._type,c=n._index.add(cc.v2(1,0));if(-1===[11,12,13,16,17,20].indexOf(l))this._canInclude(c,i)||(n._index.x++,s.runAction(e.clone()));else if(12===l||13===l||16===l||17===l){var r=n._isOpen;n._isOpen=!r,n.playAct()}}if(this._leftRow>0){this._leftRow--;for(var h=this._data1[this._leftRow],u=0;u<a.defaultCol;++u){var d=h[u],g=cc.v2(this._leftRow,u);this._showBlock(d,g,this.blockLayer,this._leftRow)}}this.scheduleOnce(this._refreshEnd,.5)},_canInclude:function(t,e){return e.some(function(e){return e.x===t.x&&e.y===t.y})},_showBtnBack:function(){this.bottomLayout.active=!!this._canTouch,this.btnBack.node.active=!this.bottomLayout.active},onBtnClickToBallBack:function(){var t=this;this._canTouch=!0,this._showBtnBack(),this.unschedule(this._shootBall,this),null===this._ballEndPos&&(this._ballEndPos=this.spBall.node.position),this.ballLayer.children.forEach(function(e){e.removeComponent(cc.PhysicsCircleCollider),e.removeComponent(cc.RigidBody),e.runAction(cc.sequence(cc.moveTo(.1,t._ballEndPos),cc.callFunc(function(){e.destroy()})))}),this.scheduleOnce(function(){t._reset(),t._moveBlocks()},.5)},_refreshEnd:function(){for(var t=this.blockLayer.childrenCount,e=0,i=[1,2,3,4,5,6,9,11,12,13,16,17],a=t-1;a>=0;--a){var o=this.blockLayer.children[a],s=o.getComponent("Block")._type;if(-1!==i.indexOf(s)&&(e++,this._checkWaring(o)))break}(0===t||e<=0)&&this._showEnd(!0)},_checkWaring:function(t){var e=this.blockLayer.width/a.defaultCol,i=this.blockLayer.height,o=Math.abs(i+t.y);return o<=.5*e?(this._showEnd(!1),!0):o>.5*e&&o<1.5*e?(this._showWarning(),!0):void 0},_showWarning:function(){var t=cc.fadeIn(1),e=cc.fadeOut(1);this.spWarning.node.active=!0,this.spWarning.node.runAction(cc.repeatForever(cc.sequence(t,e)))},_hideWaring:function(){this.spWarning.node.stopAllActions(),this.spWarning.node.active=!1},_showEnd:function(t){var e={status:t,stage:a.getCurStage(),starNum:this._starNum};l.dispatchMsg(GameLocalMsg.Msg.End,e)},_close:function(){this._ballPool.clear(),this._blockPool.clear(),s.destroyUI(this)},_calMaxScore:function(){for(var t=[1,2,3,4,5,6,9],e=0,i=this._data1.length,o=this._data2.length,s=0;s<i;++s)for(var n=0;n<o;++n)-1!==t.indexOf(this._data1[s][n])&&e++;for(var l=0;l<e;++l)this._maxScore+=(l+1)*a.baseScore},_refreshScore:function(){this._sumScore+=this._killCount*a.baseScore,this.lblTotalScore.string=this._sumScore,this._updateProgressBar()},_updateProgressBar:function(){this.progressBar.progress=parseFloat(this._sumScore/this._maxScore).toFixed(1),this.progressBar.progress>=.7&&this.progressBar.progress<1?this._starNum=2:this.progressBar.progress>=1&&(this._starNum=3),this._updateStar()},_updateStar:function(){for(var t=this.spStarArr.length,e=0;e<t;++e)e===this._starNum-1&&(this.spStarArr[e].node.active=!0)},onBtnClickToPause:function(){l.dispatchMsg(GameLocalMsg.Msg.Pause,null)},onBtnClickToItem:function(t){switch(t.target.name){case"btnItem0":this.blockLayer.children.forEach(function(t){var e=t.getComponent("Block")._type,i=t.getComponent("Block")._hp;-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(e)&&(t.getComponent("Block")._hp=Math.floor(.5*i),t.getComponent("Block").refreshHp())}),this.scheduleOnce(this._refreshEnd,.5);break;case"btnItem1":this.ballPlusFlag=!0,o.ballCount=o.ballCount+a.ballPlusCount,this._synBallCount(),this._refreshBallCount();break;case"btnItem2":var e=[];this.blockLayer.children.forEach(function(t){var i=t.getComponent("Block")._type;-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(i)&&e.push(t.getLocalZOrder())});var i=Math.max.apply(Math,e);this.blockLayer.children.forEach(function(t){var e=t.getComponent("Block")._type;t.getLocalZOrder()===i&&-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(e)&&t.destroy()}),this.scheduleOnce(this._refreshEnd,.5);break;case"btnItem3":var s=[],n=[];this.blockLayer.children.forEach(function(t){var e=t.getComponent("Block")._type,i=t.getComponent("Block")._index;-1!==[1,2,3,4,5,6,9,11,12,13,16,17].indexOf(e)&&(s.push(i.x),n.push(i))});for(var l=Math.max.apply(Math,s),c=Math.min.apply(Math,s),r=0;r<4;++r){var h=0;h=r<2?8:7,this._showUniqueBlock(c,l,n,h)}break;case"btnItem4":this.blockPlusFlag=!0;for(var u=6;u<11;++u){var d=this._blockPool.get();d||(d=cc.instantiate(this.blockPre)),this.blockLayer.addChild(d),d.getComponent("Block").initView(20,cc.v2(0,u),this.blockLayer,this._blockPool,0),d.y=-this.blockLayer.height+.5*d.height,d.name="plusBlock"}}},_showUniqueBlock:function(t,e,i,o){var s=Math.floor(cc.random0To1()*e)+t,n=Math.floor(cc.random0To1()*a.defaultCol),l=cc.v2(s,n);this._canInclude(l,i)?this._showUniqueBlock(t,e,i,o):this._showBlock(o,l,this.blockLayer,0)}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],Loading:[function(t,e,i){"use strict";cc._RF.push(e,"5b661+0QiNJiLiiU4qcPA1f","Loading");var a=t("GameData"),o=t("GameCfg"),s=t("Observer"),n=t("ObserverMgr"),l=t("UIMgr");cc.Class({extends:s,properties:{},_getMsgList:function(){return[]},_onMsg:function(t,e){},start:function(){cc.loader.loadResDir("map",cc.JsonAsset,function(t,e){if(t)console.log("\u52a0\u8f7d\u5730\u56fejson\u51fa\u9519: ",t);else{var i=e.shift(),s=o.getStageCfg();a.gamedata_savelv=void 0===s||null===s?i.json:s,a.mapdata=e,n.dispatchMsg(GameLocalMsg.Msg.GoMenu,null),this.scheduleOnce(this._close,1)}}.bind(this))},_close:function(){l.destroyUI(this)}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],MainScene:[function(t,e,i){"use strict";cc._RF.push(e,"9fec2kdV4JJvLAo0c3smCYk","MainScene");var a=t("Observer"),o=t("UIMgr"),s=t("GameData"),n=t("GameCfg");cc.Class({extends:a,properties:{addNode:{displayName:"addNode",default:null,type:cc.Node},loadingPre:{displayName:"loadingPre",default:null,type:cc.Prefab},menuPre:{displayName:"menuPre",default:null,type:cc.Prefab},gamePre:{displayName:"gamePre",default:null,type:cc.Prefab},endPre:{displayName:"endPre",default:null,type:cc.Prefab},pausePre:{displayName:"pausePre",default:null,type:cc.Prefab}},_getMsgList:function(){return[GameLocalMsg.Msg.GoMenu,GameLocalMsg.Msg.GoGame,GameLocalMsg.Msg.End,GameLocalMsg.Msg.Pause]},_onMsg:function(t,e){t===GameLocalMsg.Msg.GoMenu?this._initMenu():t===GameLocalMsg.Msg.GoGame?this._initGame():t===GameLocalMsg.Msg.End?this._initEnd(e):t===GameLocalMsg.Msg.Pause&&this._initPause()},onLoad:function(){this._initMsg(),s.init(),n.init()},start:function(){this._initLoading()},_initLoading:function(){o.createPrefab(this.loadingPre,function(t,e){this.addNode.addChild(t)}.bind(this))},_initMenu:function(){o.createPrefab(this.menuPre,function(t,e){this.addNode.addChild(t),e.getComponent("Menu").initView()}.bind(this))},_initGame:function(){o.createPrefab(this.gamePre,function(t,e){this.addNode.addChild(t),e.getComponent("Game").initView()}.bind(this))},_initEnd:function(t){o.createPrefab(this.endPre,function(e,i){this.addNode.addChild(e),i.getComponent("End").initView(t)}.bind(this))},_initPause:function(){o.createPrefab(this.pausePre,function(t,e){this.addNode.addChild(t)}.bind(this))}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",UIMgr:"UIMgr"}],Menu:[function(t,e,i){"use strict";cc._RF.push(e,"80f9eR/jklLmq/GgchEd05w","Menu");var a=t("GameData"),o=t("Observer"),s=t("UIMgr"),n=t("GameCfg");cc.Class({extends:o,properties:{_stageNodePool:null,stagePre:{displayName:"stagePre",default:null,type:cc.Prefab},scrollView:{displayName:"scrollView",default:null,type:cc.ScrollView},lblRuby:{displayName:"lblRuby",default:null,type:cc.Label},lblTime:{displayName:"lblTime",default:null,type:cc.Label},lblStar:{displayName:"lblStar",default:null,type:cc.Label}},_getMsgList:function(){return[GameLocalMsg.Msg.GoGame]},_onMsg:function(t,e){t===GameLocalMsg.Msg.GoGame&&this._close()},onLoad:function(){this._initMsg();this._stageNodePool=new cc.NodePool("Stage");for(var t=0;t<30;++t){var e=cc.instantiate(this.stagePre);this._stageNodePool.put(e)}},start:function(){},initView:function(){this.scrollView.content.destroyAllChildren();for(var t=a.mapdata.length,e=0;e<t;++e){var i=this._stageNodePool.get();i||(i=cc.instantiate(this.stagePre)),this.scrollView.content.addChild(i),i.getComponent("Stage").initView(e+1)}this.lblStar.string=n.totalStar,this.lblRuby.string=n.totalRuby},_close:function(){s.destroyUI(this)}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",Observer:"Observer",UIMgr:"UIMgr"}],ObserverMgr:[function(t,e,i){"use strict";cc._RF.push(e,"1854fcKNs5AqIfuYH778O5P","ObserverMgr"),e.exports={obsArray:{},addEventListener:function(t,e,i){void 0===i&&console.log("[ObserverMgr] \u6ce8\u518c\u6d88\u606f [%s]:%s \u7684\u4f5c\u7528\u4e8e\u672a\u5b9a\u4e49",t,e.name),void 0===this.obsArray[t]&&(this.obsArray[t]=[]);for(var a=0;a<this.obsArray[t].length;a++){var o=this.obsArray[t][a];if(o.func===e&&o.ob===i)return}this.obsArray[t].push({func:e,ob:i})},removeEventListener:function(t,e,i){var a=!1,o=this.obsArray[t];if(o)for(var s=0;s<o.length;){var n=o[s],l=n.func,c=n.ob;e===l&&i===c?(o.splice(s,1),a=!0):s++}return a},removeEventListenerWithObject:function(t){for(var e in this.obsArray)for(var i=this.obsArray[e],a=0;a<i.length;){i[a].ob===t?i.splice(a,1):a++}},cleanAllEventListener:function(){this.obsArray={}},dispatchMsg:function(t,e){var i=this.obsArray[t];if(void 0!==i)for(var a=0;a<i.length;a++){var o=i[a],s=o.func,n=o.ob;s&&n&&s.apply(n,[t,e])}else console.log("\u6d88\u606f\u5217\u8868\u4e2d\u4e0d\u5b58\u5728: "+t)}},cc._RF.pop()},{}],Observer:[function(t,e,i){"use strict";cc._RF.push(e,"1b995iNs3hBaYFkdjCujf8W","Observer");var a=t("ObserverMgr");cc.Class({extends:cc.Component,_initMsg:function(){for(var t=this._getMsgList(),e=0;e<t.length;e++){var i=t[e];a.addEventListener(i,this._onMsg,this)}},onLoad:function(){},_getMsgList:function(){return[]},_onMsg:function(t,e){},_onError:function(t,e,i){},_onNetOpen:function(){},_onErrorDeal:function(t,e){var i=e[0],a=e[1],o=e[2];this._onError(i,a,o)},onDisable:function(){a.removeEventListenerWithObject(this)},onEnable:function(){},onDestroy:function(){a.removeEventListenerWithObject(this)}}),cc._RF.pop()},{ObserverMgr:"ObserverMgr"}],Pause:[function(t,e,i){"use strict";cc._RF.push(e,"ee964sQPjFG5ZPj4wpAB943","Pause");var a=t("UIMgr"),o=t("ObserverMgr");cc.Class({extends:cc.Component,properties:{},start:function(){},onBtnClickToMenu:function(){o.dispatchMsg(GameLocalMsg.Msg.GoMenu,null),a.destroyUI(this)},onBtnClickToRetry:function(){o.dispatchMsg(GameLocalMsg.Msg.PauseRetry,null),a.destroyUI(this)},onBtnClickToContinue:function(){a.destroyUI(this)}}),cc._RF.pop()},{ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],Preview:[function(t,e,i){"use strict";cc._RF.push(e,"ba501FJe8BLaLHzMn1chAqK","Preview");var a=t("UIMgr"),o=t("GameCfg"),s=t("ObserverMgr");cc.Class({extends:cc.Component,properties:{blockLayer:{displayName:"blockLayer",default:null,type:cc.Node},blockPre:{displayName:"blockPre",default:null,type:cc.Prefab},spBg:{displayName:"spBg",default:null,type:cc.Sprite},_blockPool:null},start:function(){},initView:function(t,e){this._blockPool=e;var i=t.length,a=o.defaultCol,s=this.spBg.node.width/o.defaultCol;this.spBg.node.height=s*i*1.5;for(var n=0;n<i;++n)for(var l=0;l<a;++l){var c=t[n][l],r=cc.v2(n,l);this._showBlock(c,r,this.blockLayer,this._blockPool)}this.scheduleOnce(this._close,3)},_close:function(){s.dispatchMsg(GameLocalMsg.Msg.CanTouch,null),a.destroyUI(this)},_showBlock:function(t,e,i,a){if(0!==t){var o=this._blockPool.get();o||(o=cc.instantiate(this.blockPre)),i.addChild(o),o.getComponent("Block").initView(t,e,i,a,0,!0)}}}),cc._RF.pop()},{GameCfg:"GameCfg",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],Stage:[function(t,e,i){"use strict";cc._RF.push(e,"1bd57as/OdGGqNjyCMrgJlW","Stage");var a=t("GameCfg"),o=t("UIMgr"),s=t("ObserverMgr"),n=t("GameData");cc.Class({extends:cc.Component,properties:{spStage:{displayName:"spStage",default:null,type:cc.Sprite},lblStage:{displayName:"lblStage",default:null,type:cc.Label},_index:null,_canChoose:!1,starArr:[cc.Sprite]},onLoad:function(){this._canChoose=!1,this.lblStage.node.active=!1,this.starArr.forEach(function(t){t.node.active=!1})},start:function(){},initView:function(t){if(this._index=t,a.getCurStage()>=t){this._canChoose=!0,this.lblStage.node.active=!0,this.lblStage.string=t;o.changeSpImg("menu/mainmenu_img_stageunlockbg",this.spStage);var e=n.getStarNum(t);if(void 0===e)return;this._showStageStar(e)}},_showStageStar:function(t){for(var e=0;e<t;++e)this.starArr[e].node.active=!0},onBtnClickToStage:function(){this._canChoose&&(n.initStageData(this._index),s.dispatchMsg(GameLocalMsg.Msg.GoGame,null))}}),cc._RF.pop()},{GameCfg:"GameCfg",GameData:"GameData",ObserverMgr:"ObserverMgr",UIMgr:"UIMgr"}],UIMgr:[function(t,e,i){"use strict";cc._RF.push(e,"73f81Ikm3NJvIaB1fgU1TS5","UIMgr"),e.exports={_uiMap:{},createPrefabAddToRunningScene:function(t,e){var i=this;t?cc.loader.loadRes("common/prefab/ComUIBg",function(a,o){var s=cc.instantiate(o),n=s.getComponent("ComUIBg");if(n){var l=n.addUI(t),c=l.uuid.toString();cc.log("add uuid: "+c),i._uiMap[c]=s;var r=cc.director.getScene();if(r){var h=cc.view.getVisibleSize().width,u=cc.view.getVisibleSize().height;return s.x=h/2,s.y=u/2,r.addChild(s),void(e&&e(l))}cc.log("[UIMgr] \u6ca1\u6709\u8fd0\u884cScene,\u65e0\u6cd5\u6dfb\u52a0ui\u754c\u9762\uff01")}}):cc.log("[UIMgr] \u65e0\u6cd5\u521b\u5efaPrefab\uff1a"+t)},destroyUI:function(t){if(t){if(t.node){var e=t.node.uuid.toString(),i=this._uiMap[e];return i?(i.destroy(),void(this._uiMap[t.node.uuid.toString()]=null)):void cc.log("[UIMgr] "+t.name+" \u6ca1\u6709node\u5c5e\u6027")}cc.log("[UIMgr] "+t.name+" \u6ca1\u6709node\u5c5e\u6027")}else cc.log("[UIMgr] \u7f3a\u5c11\u53c2\u6570")},createPrefab:function(t,e){var i=this;t?cc.loader.loadRes("common/prefab/ComUIBg",function(a,o){if(a)cc.log(a.errorMessage);else{var s=cc.instantiate(o),n=s.getComponent("ComUIBg");if(n){var l=n.addUI(t),c=l.uuid.toString();i._uiMap[c]=s,e&&e(s,l)}}}):cc.log("[UIMgr] \u65e0\u6cd5\u521b\u5efaPrefab\uff1a"+t)},changeSpImg:function(t,e){cc.loader.loadRes(t,cc.SpriteFrame,function(t,i){t?console.log("\u66f4\u6362\u56fe\u7247\u9519\u8bef: ",t):e.spriteFrame=i})}},cc._RF.pop()},{}]},{},["Observer","ObserverMgr","ComUIBg","UIMgr","MainScene","AudioMgr","ButtonClickSound","End","Ball","Block","Game","Preview","GameCfg","GameData","Loading","Menu","Stage","GameLocalMsg","Pause"]);